!<arch>
myar.c~/        1477069906  21760 88    100644  11198     `
/* THIS CODE IS MY OWN WORK, IT IS WRITTEN WITHOUT CONSULTING A TUTOR OR CODE WRITTEN BY OTHER STUDENT -YIYANG ZHAO*/
// All option attempted: q A t v d x
// Please use myar [option] [arname] {file_names[]}; do not put dash (-) before options
// Ex: myar q t.ar file1 file2...    NOT myar -q ...

/*include*/
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>
#include <sys/stat.h>
#include <utime.h>
#include <time.h>
#include <ar.h>
#include <fcntl.h>
#include <stdio.h>
#include <dirent.h>

//function decs
//#include <myarheader.h>
void ar_list(int ar_fd, int verbosity);
void ar_ext(int ar_fd, int argc, char **argv);
void ar_app(int ar_fd, int argc, char **argv);
void ar_appall(int ar_fd, int argc, char **argv);
void ar_del(int ar_fd, int argc, char **argv);

//main
void print_usage()
{
		printf("Usage: myar key afile name...\n");
		printf("q	quickly append named files to archive\n");
		printf("x	extract named files\n");
		printf("t	print a concise table of contents of the archive\n");
		printf("v	print a verbose table of contents of the archive\n");
		printf("d	delete named files from archive\n");
		printf("A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself\n");
}

int main (int argc, char **argv)
{
	//myar key afile name
	/*
 	q app [named]
	x ext [named]
	t prt(cons)
	v prt(vbo)
	d del [named]
	A app all(mod'd)
	*/
	char option;
	char* ar_filename;
	char* op_filename;
	int ar_fd;

	//argument check
	if (argc <= 2){
		print_usage();
		exit(1);
	}
	//passing arguments: option and ar file name	
	option = argv[1][0];
	ar_filename = argv[2];

	if (!(option == 'q' | option == 'x'|option=='t'|option =='v'|option =='d'|option == 'A')){
		print_usage();
		exit(1);
	}
	//Open the ar file
	
	//test if arfile exist. yes->open no&&'q'|'A'->create otherwise quit
	if ( access( ar_filename, F_OK ) != -1 ){
		//open for use
		ar_fd = open(ar_filename, O_RDWR);
		char magic[8];
		magic[8] = NULL;
		read(ar_fd, magic, 8);
		if(strcmp(magic, ARMAG) != 0){
			printf("Error: File not recorgnized\n");
			close(ar_fd);
			exit(-1);
		}
	} else{

		if (option =='q'||option == 'A'){
			ar_fd = open(ar_filename, O_RDWR|O_CREAT, 0666);
           		printf("Archive file not found; creating new archive file\n");
			write(ar_fd, ARMAG, 8);
			//create file
		} else{
			printf("Error: target archive file not exist\n");	
			exit(-1);	
		}

	}

	/* 
	t,v -> ar_list(ar_fd, int 0(t)/1(v))
	x -> ar_ext(ar_fd,argc,**argv)
	q -> ar_app(ar_fd,argc,**argv)
	A -> ar_appall(ar_fd,(cwd?)) -> ar_app
	d -> ar_del(ar_fd,argc,**argv)
	*/
	switch(option){
	
		case('t'):
			ar_list(ar_fd,0);
			break;
		case('v'):
			ar_list(ar_fd,1);
			break;
		case('q'):
			ar_app(ar_fd,argc,argv);
			break;
		case('x'):
			ar_ext(ar_fd,argc,argv);
			break;
		case('A'):
			ar_appall(ar_fd,argc,argv);
			break;

		case('d'):
			ar_del(ar_fd,argc,argv);
			break;
		default:
			exit(-1);
	}

}


void ar_list(int ar_fd, int verbosity){
	//DONE
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	
	while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)) {
		//printf("readaaa\n");		
		int i;
		int filesize = (int)strtol(file_header->ar_size,NULL,10);		
		for (i=15;i>0;i--){
			//printf("%d\n",i);
			if (file_header->ar_name[i] == '/'){
				file_header->ar_name[i] = NULL;
				break;
			}
		}	
	
		if (!(verbosity)){
			printf("%s\n",file_header->ar_name);
		}else{

			//DONE
			// 3*3mode uid/gid   size timestamp[Oct 13 19:35 2016] filename
			int j;
			//mode			
			for (j=3;j<6;j++){
				int per = file_header->ar_mode[j] - '0';
				int perx = per % 2;
				per = per/2;
				int perw = per % 2;
				per = per/2;
				int perr = per % 2;
				if (perr) printf("r"); else printf("-");
				if (perw) printf("w"); else printf("-");
				if (perx) printf("x"); else printf("-");
			}
			//printf(" ");

			//uid/gid
			int uid = atoi(file_header->ar_uid);
			int gid = atoi(file_header->ar_gid);
			printf("%6d/%-6d ",uid, gid);
			printf("%d", filesize);
			time_t mtimestamp;	 
			mtimestamp = strtol(file_header->ar_date,NULL,10);
			char* printtime[20];
			strftime(printtime, 20, " %b %e %R %Y", localtime(&mtimestamp));
			printf("%-20s", printtime);
			printf("%-16s\n",file_header->ar_name);
		}	
		char *something_weird;	
		
		//printf("%d\n", filesize);
		if (filesize%2) filesize++;
		lseek(ar_fd,filesize,SEEK_CUR);


		
	}

	close(ar_fd);
}


void ar_ext(int ar_fd, int argc, char **argv){
	//TODO

	int i;
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	printf("%d\n",argc);
	for (i=3;i<argc;i++){
		printf("finding %s\n",argv[i]);
		//find named file
		int filesize;
		int flag = 0;
		while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
			int j;			
			for (j = 16; j >=0; j--){
            			if (file_header->ar_name[j] == '/') {
               				file_header->ar_name[j] = '\0';
                 			
					break;
           		 	}
      		 	}
			filesize = (int)strtol(file_header->ar_size,NULL,10);
			
			if ((strcmp(file_header->ar_name, argv[i]) != 0)){
				//skip
				if (filesize%2) filesize++;
				lseek(ar_fd,filesize,SEEK_CUR);
				printf("going thru:%s\n",file_header->ar_name);
		
			} else{
				//break
				flag = 1;
				printf("found %s\n",file_header->ar_name);
				break;
			}
		}
	
		if (flag == 0) {
			printf("Error: file to extract not found.\n");
			exit(-1);
		}
		//create a file	
		struct utimbuf *file_utime = malloc(sizeof(struct utimbuf));
   	 	int *file_mode;
   		time_t file_time;
		
		sscanf(file_header->ar_mode, "%o", file_mode);
		file_time = (time_t)strtol(file_header->ar_date,NULL,10);
		file_utime->actime = file_time;
		file_utime->modtime = file_time;
		//extract its content write using buffer
		printf("%s\n %o\n",file_header->ar_mode,*file_mode);
		int extf_fd = creat(file_header->ar_name,  *file_mode);

			
		struct stat *f_stat = malloc(sizeof(struct stat));
		fstat(extf_fd, f_stat);
		

		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int remaining_size = filesize;
		int actual_size;

		while(remaining_size > f_blocks){
			actual_size = read(ar_fd,f_buffer,f_blocks);
			write(extf_fd,f_buffer,actual_size);
			remaining_size -= actual_size;
		}
		actual_size = read(ar_fd,f_buffer,remaining_size);
		write(extf_fd,f_buffer,actual_size);

		
		close(extf_fd);
		//change time ?
		utime(file_header->ar_name,file_utime);
		
		//lseek to the head?
		lseek(ar_fd,0,8);
	}
	close(ar_fd);
}

void ar_app(int ar_fd, int argc, char **argv){
	//DONE
	//passing in all argument as the main method because we want the list of file names
	//printf("%s\n",argv[3]);
	int file_num = argc - 3;
	int i;
	char* f_name;
	lseek(ar_fd,0,SEEK_END);	
	for (i=3;i<argc;i++){
		
		f_name = argv[i];
		//printf("%s\n",f_name);
		int target_fd;
		struct ar_hdr *f_hdr = malloc(sizeof(struct ar_hdr));
		struct stat *f_stat = malloc(sizeof(struct stat));
		target_fd = open(f_name, O_RDONLY); //the file to be appended
		
		if (target_fd == -1){
			printf("Error: Target file to append not found\n");
			close(target_fd);
			close(ar_fd);
			exit(-1);
		}
		//get metadata of the file 
		fstat(target_fd, f_stat);
		int f_blksz = (int)f_stat->st_blksize;

		char namestr[strlen(f_name)+1];
		strcpy (namestr,f_name);		
		strcat(namestr, "/");
		
		/*
		name 16
		date 12
		uid 6
		gid 6
		mode 8
		size 10
		famg 2
		
		*/
		sprintf(f_hdr->ar_name, "%-16s", namestr);
		sprintf(f_hdr->ar_date,"%-12d",(int)f_stat->st_mtime);
		sprintf(f_hdr->ar_uid,"%-6d", (int)f_stat->st_uid);
		sprintf(f_hdr->ar_gid,"%-6d", (int)f_stat->st_gid);
		
		sprintf(f_hdr->ar_mode,"%-8o",f_stat->st_mode);
		sprintf(f_hdr->ar_size,"%-10d",(int)f_stat->st_size);
		sprintf(f_hdr->ar_fmag,"%-2s",ARFMAG);	
		//printf("%s\n",f_hdr);
		write(ar_fd,f_hdr,sizeof(struct ar_hdr));
		
		//copy the content of the file
		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int actual_size;
		while(actual_size = read(target_fd,f_buffer,f_blocks)){
			
			write(ar_fd,f_buffer,actual_size);

		}
		
		if ((lseek(ar_fd,0,SEEK_END)%2)){
			write(ar_fd,"\n",1);
		}
		
		close(target_fd);

	}
	close(ar_fd);
	exit(0);

}

void ar_appall(int ar_fd, int argc, char **argv){
	//TODO- DONE but need to check
	//artificially generate a list as argv and argc then pass into ar_app :)
	//check current dir, add all file mod in 1h except argv[0] to new_argv
	int count = 0;
	
	DIR *dp;
	dp = opendir("./");
	struct dirent *ep;
	char* new_argv[10000];
	new_argv[0] = argv[0];
	new_argv[1] = "q";
	new_argv[2] = argv[2];
	int new_argc = 2;
	
	while (ep = readdir(dp) ){
		if ((ep->d_type == DT_REG) && (strcmp(ep->d_name, argv[2]) != 0)){
			char* filename = ep->d_name;
			struct stat *f_stat = malloc(sizeof(struct stat));
			stat(filename,f_stat);
			//printf("%s\n",filename);
			//printf("%f\n",difftime(time(NULL), f_stat->st_mtime));
			if  ( difftime(time(NULL), f_stat->st_mtime)<=3600){
				new_argc ++;
				new_argv[new_argc] = filename;
				

			}
		}
		

	}
	ar_app(ar_fd,new_argc,new_argv);

	

}

void ar_del(int ar_fd, int argc, char **argv){
	//TODO
	//read through the ar file
	//maintain a list of file 2b deleted
	//if (inlist){skip;inlist.rm()file;} else {read and write}	

	char* to_del[argc - 3];
	int num_to_del = argc - 3;
	int i;
	struct stat *f_stat = malloc(sizeof(struct stat));
	for (i=0; i<argc-3;i++){
		to_del[i] = argv[i+3];
	}
	//creat a new file
	unlink(argv[2]);
	int new_ar_fd= open(argv[2],O_RDWR|O_CREAT,0666);
	write(new_ar_fd, ARMAG, 8);
	fstat(new_ar_fd, f_stat);
	int f_blocks = (int)f_stat->st_blocks;

	//each time read a header and go thru the del_list
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));

	while(read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
		//if inlist?
		
		char *filename = malloc(20);
		sprintf(filename, "%-16s", file_header->ar_name);		
		int j;
		
		for (j=16;j>=0;j--){
			if (filename[j] == '/'){
				filename[j] = '\0';
				break;
			}

		}
		//printf("Searching %s\n",filename);
		int flag = 0;
		for (j=0;j<argc-3;j++){
			//printf("against %s\n",to_del[j]);			
			if ((strcmp(filename, to_del[j]) == 0)){
				
				flag = 1;			
				to_del[j] = "\n";
				break;

			}
		}
		
		int filesize = (int)strtol(file_header->ar_size,NULL,10);
		if (flag == 0){
			//write



			write(new_ar_fd,file_header,sizeof(struct ar_hdr));
			
			//copy the content of the file

			char* f_buffer[f_blocks];
			int remaining_size = filesize;
			int actual_size;

			while(remaining_size > f_blocks){
				actual_size = read(ar_fd,f_buffer,f_blocks);
				write(new_ar_fd,f_buffer,actual_size);
				remaining_size -= actual_size;
			}
			actual_size = read(ar_fd,f_buffer,remaining_size);
			write(new_ar_fd,f_buffer,actual_size);
		
			if ((lseek(new_ar_fd,0,SEEK_CUR)%2)){
				write(new_ar_fd,"\n",1);
			}

			if ((lseek(ar_fd,0,SEEK_CUR)%2)){
				lseek(ar_fd,1,SEEK_CUR);
			}

		} else {
			//skip
			
			if (filesize%2) filesize++;
			lseek(ar_fd,filesize,SEEK_CUR);
			printf("going thru:%s\n",file_header->ar_name);
			
		}

	}

	close(ar_fd);
	close(new_ar_fd);
	exit(0);
}

#myar.c#/       1477069719  21760 88    100644  11198     `
/* THIS CODE IS MY OWN WORK, IT IS WRITTEN WITHOUT CONSULTING A TUTOR OR CODE WRITTEN BY OTHER STUDENT -YIYANG ZHAO*/
// All option attempted: q A t v d x
// Please use myar [option] [arname] {file_names[]}; do not put dash (-) before options
// Ex: myar q t.ar file1 file2...    NOT myar -q ...

/*include*/
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>
#include <sys/stat.h>
#include <utime.h>
#include <time.h>
#include <ar.h>
#include <fcntl.h>
#include <stdio.h>
#include <dirent.h>

//function decs
//#include <myarheader.h>
void ar_list(int ar_fd, int verbosity);
void ar_ext(int ar_fd, int argc, char **argv);
void ar_app(int ar_fd, int argc, char **argv);
void ar_appall(int ar_fd, int argc, char **argv);
void ar_del(int ar_fd, int argc, char **argv);

//main
void print_usage()
{
		printf("Usage: myar key afile name...\n");
		printf("q	quickly append named files to archive\n");
		printf("x	extract named files\n");
		printf("t	print a concise table of contents of the archive\n");
		printf("v	print a verbose table of contents of the archive\n");
		printf("d	delete named files from archive\n");
		printf("A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself\n");
}

int main (int argc, char **argv)
{
	//myar key afile name
	/*
 	q app [named]
	x ext [named]
	t prt(cons)
	v prt(vbo)
	d del [named]
	A app all(mod'd)
	*/
	char option;
	char* ar_filename;
	char* op_filename;
	int ar_fd;

	//argument check
	if (argc <= 2){
		print_usage();
		exit(1);
	}
	//passing arguments: option and ar file name	
	option = argv[1][0];
	ar_filename = argv[2];

	if (!(option == 'q' | option == 'x'|option=='t'|option =='v'|option =='d'|option == 'A')){
		print_usage();
		exit(1);
	}
	//Open the ar file
	
	//test if arfile exist. yes->open no&&'q'|'A'->create otherwise quit
	if ( access( ar_filename, F_OK ) != -1 ){
		//open for use
		ar_fd = open(ar_filename, O_RDWR);
		char magic[8];
		magic[8] = NULL;
		read(ar_fd, magic, 8);
		if(strcmp(magic, ARMAG) != 0){
			printf("Error: File not recorgnized\n");
			close(ar_fd);
			exit(-1);
		}
	} else{

		if (option =='q'||option == 'A'){
			ar_fd = open(ar_filename, O_RDWR|O_CREAT, 0666);
           		printf("Archive file not found; creating new archive file\n");
			write(ar_fd, ARMAG, 8);
			//create file
		} else{
			printf("Error: target archive file not exist\n");	
			exit(-1);	
		}

	}

	/* 
	t,v -> ar_list(ar_fd, int 0(t)/1(v))
	x -> ar_ext(ar_fd,argc,**argv)
	q -> ar_app(ar_fd,argc,**argv)
	A -> ar_appall(ar_fd,(cwd?)) -> ar_app
	d -> ar_del(ar_fd,argc,**argv)
	*/
	switch(option){
	
		case('t'):
			ar_list(ar_fd,0);
			break;
		case('v'):
			ar_list(ar_fd,1);
			break;
		case('q'):
			ar_app(ar_fd,argc,argv);
			break;
		case('x'):
			ar_ext(ar_fd,argc,argv);
			break;
		case('A'):
			ar_appall(ar_fd,argc,argv);
			break;

		case('d'):
			ar_del(ar_fd,argc,argv);
			break;
		default:
			exit(-1);
	}

}


void ar_list(int ar_fd, int verbosity){
	//DONE
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	
	while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)) {
		//printf("readaaa\n");		
		int i;
		int filesize = (int)strtol(file_header->ar_size,NULL,10);		
		for (i=15;i>0;i--){
			//printf("%d\n",i);
			if (file_header->ar_name[i] == '/'){
				file_header->ar_name[i] = NULL;
				break;
			}
		}	
	
		if (!(verbosity)){
			printf("%s\n",file_header->ar_name);
		}else{

			//DONE
			// 3*3mode uid/gid   size timestamp[Oct 13 19:35 2016] filename
			int j;
			//mode			
			for (j=3;j<6;j++){
				int per = file_header->ar_mode[j] - '0';
				int perx = per % 2;
				per = per/2;
				int perw = per % 2;
				per = per/2;
				int perr = per % 2;
				if (perr) printf("r"); else printf("-");
				if (perw) printf("w"); else printf("-");
				if (perx) printf("x"); else printf("-");
			}
			//printf(" ");

			//uid/gid
			int uid = atoi(file_header->ar_uid);
			int gid = atoi(file_header->ar_gid);
			printf("%6d/%-6d ",uid, gid);
			printf("%d", filesize);
			time_t mtimestamp;	 
			mtimestamp = strtol(file_header->ar_date,NULL,10);
			char* printtime[20];
			strftime(printtime, 20, " %b %e %R %Y", localtime(&mtimestamp));
			printf("%-20s", printtime);
			printf("%-16s\n",file_header->ar_name);
		}	
		char *something_weird;	
		
		//printf("%d\n", filesize);
		if (filesize%2) filesize++;
		lseek(ar_fd,filesize,SEEK_CUR);


		
	}

	close(ar_fd);
}


void ar_ext(int ar_fd, int argc, char **argv){
	//TODO

	int i;
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	printf("%d\n",argc);
	for (i=3;i<argc;i++){
		printf("finding %s\n",argv[i]);
		//find named file
		int filesize;
		int flag = 0;
		while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
			int j;			
			for (j = 16; j >=0; j--){
            			if (file_header->ar_name[j] == '/') {
               				file_header->ar_name[j] = '\0';
                 			
					break;
           		 	}
      		 	}
			filesize = (int)strtol(file_header->ar_size,NULL,10);
			
			if ((strcmp(file_header->ar_name, argv[i]) != 0)){
				//skip
				if (filesize%2) filesize++;
				lseek(ar_fd,filesize,SEEK_CUR);
				printf("going thru:%s\n",file_header->ar_name);
		
			} else{
				//break
				flag = 1;
				printf("found %s\n",file_header->ar_name);
				break;
			}
		}
	
		if (flag == 0) {
			printf("Error: file to extract not found.\n");
			exit(-1);
		}
		//create a file	
		struct utimbuf *file_utime = malloc(sizeof(struct utimbuf));
   	 	int *file_mode;
   		time_t file_time;
		
		sscanf(file_header->ar_mode, "%o", file_mode);
		file_time = (time_t)strtol(file_header->ar_date,NULL,10);
		file_utime->actime = file_time;
		file_utime->modtime = file_time;
		//extract its content write using buffer
		printf("%s\n %o\n",file_header->ar_mode,*file_mode);
		int extf_fd = creat(file_header->ar_name,  *file_mode);

			
		struct stat *f_stat = malloc(sizeof(struct stat));
		fstat(extf_fd, f_stat);
		

		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int remaining_size = filesize;
		int actual_size;

		while(remaining_size > f_blocks){
			actual_size = read(ar_fd,f_buffer,f_blocks);
			write(extf_fd,f_buffer,actual_size);
			remaining_size -= actual_size;
		}
		actual_size = read(ar_fd,f_buffer,remaining_size);
		write(extf_fd,f_buffer,actual_size);

		
		close(extf_fd);
		//change time ?
		utime(file_header->ar_name,file_utime);
		
		//lseek to the head?
		lseek(ar_fd,0,8);
	}
	close(ar_fd);
}

void ar_app(int ar_fd, int argc, char **argv){
	//DONE
	//passing in all argument as the main method because we want the list of file names
	//printf("%s\n",argv[3]);
	int file_num = argc - 3;
	int i;
	char* f_name;
	lseek(ar_fd,0,SEEK_END);	
	for (i=3;i<argc;i++){
		
		f_name = argv[i];
		//printf("%s\n",f_name);
		int target_fd;
		struct ar_hdr *f_hdr = malloc(sizeof(struct ar_hdr));
		struct stat *f_stat = malloc(sizeof(struct stat));
		target_fd = open(f_name, O_RDONLY); //the file to be appended
		
		if (target_fd == -1){
			printf("Error: Target file to append not found\n");
			close(target_fd);
			close(ar_fd);
			exit(-1);
		}
		//get metadata of the file 
		fstat(target_fd, f_stat);
		int f_blksz = (int)f_stat->st_blksize;

		char namestr[strlen(f_name)+1];
		strcpy (namestr,f_name);		
		strcat(namestr, "/");
		
		/*
		name 16
		date 12
		uid 6
		gid 6
		mode 8
		size 10
		famg 2
		
		*/
		sprintf(f_hdr->ar_name, "%-16s", namestr);
		sprintf(f_hdr->ar_date,"%-12d",(int)f_stat->st_mtime);
		sprintf(f_hdr->ar_uid,"%-6d", (int)f_stat->st_uid);
		sprintf(f_hdr->ar_gid,"%-6d", (int)f_stat->st_gid);
		
		sprintf(f_hdr->ar_mode,"%-8o",f_stat->st_mode);
		sprintf(f_hdr->ar_size,"%-10d",(int)f_stat->st_size);
		sprintf(f_hdr->ar_fmag,"%-2s",ARFMAG);	
		//printf("%s\n",f_hdr);
		write(ar_fd,f_hdr,sizeof(struct ar_hdr));
		
		//copy the content of the file
		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int actual_size;
		while(actual_size = read(target_fd,f_buffer,f_blocks)){
			
			write(ar_fd,f_buffer,actual_size);

		}
		
		if ((lseek(ar_fd,0,SEEK_END)%2)){
			write(ar_fd,"\n",1);
		}
		
		close(target_fd);

	}
	close(ar_fd);
	exit(0);

}

void ar_appall(int ar_fd, int argc, char **argv){
	//TODO- DONE but need to check
	//artificially generate a list as argv and argc then pass into ar_app :)
	//check current dir, add all file mod in 1h except argv[0] to new_argv
	int count = 0;
	
	DIR *dp;
	dp = opendir("./");
	struct dirent *ep;
	char* new_argv[10000];
	new_argv[0] = argv[0];
	new_argv[1] = "q";
	new_argv[2] = argv[2];
	int new_argc = 2;
	
	while (ep = readdir(dp)){
		if ((ep->d_type == DT_REG) && (strcmp(ep->d_name, argv[2]) != 0)){
			char* filename = ep->d_name;
			struct stat *f_stat = malloc(sizeof(struct stat));
			stat(filename,f_stat);
			//printf("%s\n",filename);
			//printf("%f\n",difftime(time(NULL), f_stat->st_mtime));
			if  ( difftime(time(NULL), f_stat->st_mtime)<=3600){
				new_argc ++;
				new_argv[new_argc] = filename;
				

			}
		}
		

	}

	ar_app(ar_fd,new_argc,new_argv);

	

}

void ar_del(int ar_fd, int argc, char **argv){
	//TODO
	//read through the ar file
	//maintain a list of file 2b deleted
	//if (inlist){skip;inlist.rm()file;} else {read and write}	

	char* to_del[argc - 3];
	int num_to_del = argc - 3;
	int i;
	struct stat *f_stat = malloc(sizeof(struct stat));
	for (i=0; i<argc-3;i++){
		to_del[i] = argv[i+3];
	}
	//creat a new file
	unlink(argv[2]);
	int new_ar_fd= open(argv[2],O_RDWR|O_CREAT,0666);
	write(new_ar_fd, ARMAG, 8);
	fstat(new_ar_fd, f_stat);
	int f_blocks = (int)f_stat->st_blocks;

	//each time read a header and go thru the del_list
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));

	while(read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
		//if inlist?
		
		char *filename = malloc(20);
		sprintf(filename, "%-16s", file_header->ar_name);		
		int j;
		
		for (j=16;j>=0;j--){
			if (filename[j] == '/'){
				filename[j] = '\0';
				break;
			}

		}
		//printf("Searching %s\n",filename);
		int flag = 0;
		for (j=0;j<argc-3;j++){
			//printf("against %s\n",to_del[j]);			
			if ((strcmp(filename, to_del[j]) == 0)){
				
				flag = 1;			
				to_del[j] = "\n";
				break;

			}
		}
		
		int filesize = (int)strtol(file_header->ar_size,NULL,10);
		if (flag == 0){
			//write



			write(new_ar_fd,file_header,sizeof(struct ar_hdr));
			
			//copy the content of the file

			char* f_buffer[f_blocks];
			int remaining_size = filesize;
			int actual_size;

			while(remaining_size > f_blocks){
				actual_size = read(ar_fd,f_buffer,f_blocks);
				write(new_ar_fd,f_buffer,actual_size);
				remaining_size -= actual_size;
			}
			actual_size = read(ar_fd,f_buffer,remaining_size);
			write(new_ar_fd,f_buffer,actual_size);
		
			if ((lseek(new_ar_fd,0,SEEK_CUR)%2)){
				write(new_ar_fd,"\n",1);
			}

			if ((lseek(ar_fd,0,SEEK_CUR)%2)){
				lseek(ar_fd,1,SEEK_CUR);
			}

		} else {
			//skip
			
			if (filesize%2) filesize++;
			lseek(ar_fd,filesize,SEEK_CUR);
			printf("going thru:%s\n",file_header->ar_name);
			
		}

	}

	close(ar_fd);
	close(new_ar_fd);
	exit(0);
}

wangletian/     1477069914  21760 88    100644  98778     `
!<arch>
myar.c~/        1477069854  21760 88    100644  11205     `
/* THIS CODE IS MY OWN WORK, IT IS WRITTEN WITHOUT CONSULTING A TUTOR OR CODE WRITTEN BY OTHER STUDENT -YIYANG ZHAO*/
// All option attempted: q A t v d x
// Please use myar [option] [arname] {file_names[]}; do not put dash (-) before options
// Ex: myar q t.ar file1 file2...    NOT myar -q ...

/*include*/
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>
#include <sys/stat.h>
#include <utime.h>
#include <time.h>
#include <ar.h>
#include <fcntl.h>
#include <stdio.h>
#include <dirent.h>

//function decs
//#include <myarheader.h>
void ar_list(int ar_fd, int verbosity);
void ar_ext(int ar_fd, int argc, char **argv);
void ar_app(int ar_fd, int argc, char **argv);
void ar_appall(int ar_fd, int argc, char **argv);
void ar_del(int ar_fd, int argc, char **argv);

//main
void print_usage()
{
		printf("Usage: myar key afile name...\n");
		printf("q	quickly append named files to archive\n");
		printf("x	extract named files\n");
		printf("t	print a concise table of contents of the archive\n");
		printf("v	print a verbose table of contents of the archive\n");
		printf("d	delete named files from archive\n");
		printf("A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself\n");
}

int main (int argc, char **argv)
{
	//myar key afile name
	/*
 	q app [named]
	x ext [named]
	t prt(cons)
	v prt(vbo)
	d del [named]
	A app all(mod'd)
	*/
	char option;
	char* ar_filename;
	char* op_filename;
	int ar_fd;

	//argument check
	if (argc <= 2){
		print_usage();
		exit(1);
	}
	//passing arguments: option and ar file name	
	option = argv[1][0];
	ar_filename = argv[2];

	if (!(option == 'q' | option == 'x'|option=='t'|option =='v'|option =='d'|option == 'A')){
		print_usage();
		exit(1);
	}
	//Open the ar file
	
	//test if arfile exist. yes->open no&&'q'|'A'->create otherwise quit
	if ( access( ar_filename, F_OK ) != -1 ){
		//open for use
		ar_fd = open(ar_filename, O_RDWR);
		char magic[8];
		magic[8] = NULL;
		read(ar_fd, magic, 8);
		if(strcmp(magic, ARMAG) != 0){
			printf("Error: File not recorgnized\n");
			close(ar_fd);
			exit(-1);
		}
	} else{

		if (option =='q'||option == 'A'){
			ar_fd = open(ar_filename, O_RDWR|O_CREAT, 0666);
           		printf("Archive file not found; creating new archive file\n");
			write(ar_fd, ARMAG, 8);
			//create file
		} else{
			printf("Error: target archive file not exist\n");	
			exit(-1);	
		}

	}

	/* 
	t,v -> ar_list(ar_fd, int 0(t)/1(v))
	x -> ar_ext(ar_fd,argc,**argv)
	q -> ar_app(ar_fd,argc,**argv)
	A -> ar_appall(ar_fd,(cwd?)) -> ar_app
	d -> ar_del(ar_fd,argc,**argv)
	*/
	switch(option){
	
		case('t'):
			ar_list(ar_fd,0);
			break;
		case('v'):
			ar_list(ar_fd,1);
			break;
		case('q'):
			ar_app(ar_fd,argc,argv);
			break;
		case('x'):
			ar_ext(ar_fd,argc,argv);
			break;
		case('A'):
			ar_appall(ar_fd,argc,argv);
			break;

		case('d'):
			ar_del(ar_fd,argc,argv);
			break;
		default:
			exit(-1);
	}

}


void ar_list(int ar_fd, int verbosity){
	//DONE
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	
	while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)) {
		//printf("readaaa\n");		
		int i;
		int filesize = (int)strtol(file_header->ar_size,NULL,10);		
		for (i=15;i>0;i--){
			//printf("%d\n",i);
			if (file_header->ar_name[i] == '/'){
				file_header->ar_name[i] = NULL;
				break;
			}
		}	
	
		if (!(verbosity)){
			printf("%s\n",file_header->ar_name);
		}else{

			//DONE
			// 3*3mode uid/gid   size timestamp[Oct 13 19:35 2016] filename
			int j;
			//mode			
			for (j=3;j<6;j++){
				int per = file_header->ar_mode[j] - '0';
				int perx = per % 2;
				per = per/2;
				int perw = per % 2;
				per = per/2;
				int perr = per % 2;
				if (perr) printf("r"); else printf("-");
				if (perw) printf("w"); else printf("-");
				if (perx) printf("x"); else printf("-");
			}
			//printf(" ");

			//uid/gid
			int uid = atoi(file_header->ar_uid);
			int gid = atoi(file_header->ar_gid);
			printf("%6d/%-6d ",uid, gid);
			printf("%d", filesize);
			time_t mtimestamp;	 
			mtimestamp = strtol(file_header->ar_date,NULL,10);
			char* printtime[20];
			strftime(printtime, 20, " %b %e %R %Y", localtime(&mtimestamp));
			printf("%-20s", printtime);
			printf("%-16s\n",file_header->ar_name);
		}	
		char *something_weird;	
		
		//printf("%d\n", filesize);
		if (filesize%2) filesize++;
		lseek(ar_fd,filesize,SEEK_CUR);


		
	}

	close(ar_fd);
}


void ar_ext(int ar_fd, int argc, char **argv){
	//TODO

	int i;
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	printf("%d\n",argc);
	for (i=3;i<argc;i++){
		printf("finding %s\n",argv[i]);
		//find named file
		int filesize;
		int flag = 0;
		while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
			int j;			
			for (j = 16; j >=0; j--){
            			if (file_header->ar_name[j] == '/') {
               				file_header->ar_name[j] = '\0';
                 			
					break;
           		 	}
      		 	}
			filesize = (int)strtol(file_header->ar_size,NULL,10);
			
			if ((strcmp(file_header->ar_name, argv[i]) != 0)){
				//skip
				if (filesize%2) filesize++;
				lseek(ar_fd,filesize,SEEK_CUR);
				printf("going thru:%s\n",file_header->ar_name);
		
			} else{
				//break
				flag = 1;
				printf("found %s\n",file_header->ar_name);
				break;
			}
		}
	
		if (flag == 0) {
			printf("Error: file to extract not found.\n");
			exit(-1);
		}
		//create a file	
		struct utimbuf *file_utime = malloc(sizeof(struct utimbuf));
   	 	int *file_mode;
   		time_t file_time;
		
		sscanf(file_header->ar_mode, "%o", file_mode);
		file_time = (time_t)strtol(file_header->ar_date,NULL,10);
		file_utime->actime = file_time;
		file_utime->modtime = file_time;
		//extract its content write using buffer
		printf("%s\n %o\n",file_header->ar_mode,*file_mode);
		int extf_fd = creat(file_header->ar_name,  *file_mode);

			
		struct stat *f_stat = malloc(sizeof(struct stat));
		fstat(extf_fd, f_stat);
		

		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int remaining_size = filesize;
		int actual_size;

		while(remaining_size > f_blocks){
			actual_size = read(ar_fd,f_buffer,f_blocks);
			write(extf_fd,f_buffer,actual_size);
			remaining_size -= actual_size;
		}
		actual_size = read(ar_fd,f_buffer,remaining_size);
		write(extf_fd,f_buffer,actual_size);

		
		close(extf_fd);
		//change time ?
		utime(file_header->ar_name,file_utime);
		
		//lseek to the head?
		lseek(ar_fd,0,8);
	}
	close(ar_fd);
}

void ar_app(int ar_fd, int argc, char **argv){
	//DONE
	//passing in all argument as the main method because we want the list of file names
	//printf("%s\n",argv[3]);
	int file_num = argc - 3;
	int i;
	char* f_name;
	lseek(ar_fd,0,SEEK_END);	
	for (i=3;i<argc;i++){
		
		f_name = argv[i];
		//printf("%s\n",f_name);
		int target_fd;
		struct ar_hdr *f_hdr = malloc(sizeof(struct ar_hdr));
		struct stat *f_stat = malloc(sizeof(struct stat));
		target_fd = open(f_name, O_RDONLY); //the file to be appended
		
		if (target_fd == -1){
			printf("Error: Target file to append not found\n");
			close(target_fd);
			close(ar_fd);
			exit(-1);
		}
		//get metadata of the file 
		fstat(target_fd, f_stat);
		int f_blksz = (int)f_stat->st_blksize;

		char namestr[strlen(f_name)+1];
		strcpy (namestr,f_name);		
		strcat(namestr, "/");
		
		/*
		name 16
		date 12
		uid 6
		gid 6
		mode 8
		size 10
		famg 2
		
		*/
		sprintf(f_hdr->ar_name, "%-16s", namestr);
		sprintf(f_hdr->ar_date,"%-12d",(int)f_stat->st_mtime);
		sprintf(f_hdr->ar_uid,"%-6d", (int)f_stat->st_uid);
		sprintf(f_hdr->ar_gid,"%-6d", (int)f_stat->st_gid);
		
		sprintf(f_hdr->ar_mode,"%-8o",f_stat->st_mode);
		sprintf(f_hdr->ar_size,"%-10d",(int)f_stat->st_size);
		sprintf(f_hdr->ar_fmag,"%-2s",ARFMAG);	
		//printf("%s\n",f_hdr);
		write(ar_fd,f_hdr,sizeof(struct ar_hdr));
		
		//copy the content of the file
		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int actual_size;
		while(actual_size = read(target_fd,f_buffer,f_blocks)){
			
			write(ar_fd,f_buffer,actual_size);

		}
		
		if ((lseek(ar_fd,0,SEEK_END)%2)){
			write(ar_fd,"\n",1);
		}
		
		close(target_fd);

	}
	close(ar_fd);
	exit(0);

}

void ar_appall(int ar_fd, int argc, char **argv){
	//TODO- DONE but need to check
	//artificially generate a list as argv and argc then pass into ar_app :)
	//check current dir, add all file mod in 1h except argv[0] to new_argv
	int count = 0;
	
	DIR *dp;
	dp = opendir("./");
	struct dirent *ep;
	char* new_argv[10000];
	new_argv[0] = argv[0];
	new_argv[1] = "q";
	new_argv[2] = argv[2];
	int new_argc = 2;
	
	while (ep = readdir(dp) != NULL){
		if ((ep->d_type == DT_REG) && (strcmp(ep->d_name, argv[2]) != 0)){
			char* filename = ep->d_name;
			struct stat *f_stat = malloc(sizeof(struct stat));
			stat(filename,f_stat);
			//printf("%s\n",filename);
			//printf("%f\n",difftime(time(NULL), f_stat->st_mtime));
			if  ( difftime(time(NULL), f_stat->st_mtime)<=3600){
				new_argc ++;
				new_argv[new_argc] = filename;
				

			}
		}
		

	}
	ar_app(ar_fd,new_argc,new_argv);

	

}

void ar_del(int ar_fd, int argc, char **argv){
	//TODO
	//read through the ar file
	//maintain a list of file 2b deleted
	//if (inlist){skip;inlist.rm()file;} else {read and write}	

	char* to_del[argc - 3];
	int num_to_del = argc - 3;
	int i;
	struct stat *f_stat = malloc(sizeof(struct stat));
	for (i=0; i<argc-3;i++){
		to_del[i] = argv[i+3];
	}
	//creat a new file
	unlink(argv[2]);
	int new_ar_fd= open(argv[2],O_RDWR|O_CREAT,0666);
	write(new_ar_fd, ARMAG, 8);
	fstat(new_ar_fd, f_stat);
	int f_blocks = (int)f_stat->st_blocks;

	//each time read a header and go thru the del_list
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));

	while(read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
		//if inlist?
		
		char *filename = malloc(20);
		sprintf(filename, "%-16s", file_header->ar_name);		
		int j;
		
		for (j=16;j>=0;j--){
			if (filename[j] == '/'){
				filename[j] = '\0';
				break;
			}

		}
		//printf("Searching %s\n",filename);
		int flag = 0;
		for (j=0;j<argc-3;j++){
			//printf("against %s\n",to_del[j]);			
			if ((strcmp(filename, to_del[j]) == 0)){
				
				flag = 1;			
				to_del[j] = "\n";
				break;

			}
		}
		
		int filesize = (int)strtol(file_header->ar_size,NULL,10);
		if (flag == 0){
			//write



			write(new_ar_fd,file_header,sizeof(struct ar_hdr));
			
			//copy the content of the file

			char* f_buffer[f_blocks];
			int remaining_size = filesize;
			int actual_size;

			while(remaining_size > f_blocks){
				actual_size = read(ar_fd,f_buffer,f_blocks);
				write(new_ar_fd,f_buffer,actual_size);
				remaining_size -= actual_size;
			}
			actual_size = read(ar_fd,f_buffer,remaining_size);
			write(new_ar_fd,f_buffer,actual_size);
		
			if ((lseek(new_ar_fd,0,SEEK_CUR)%2)){
				write(new_ar_fd,"\n",1);
			}

			if ((lseek(ar_fd,0,SEEK_CUR)%2)){
				lseek(ar_fd,1,SEEK_CUR);
			}

		} else {
			//skip
			
			if (filesize%2) filesize++;
			lseek(ar_fd,filesize,SEEK_CUR);
			printf("going thru:%s\n",file_header->ar_name);
			
		}

	}

	close(ar_fd);
	close(new_ar_fd);
	exit(0);
}


#myar.c#/       1477069719  21760 88    100644  11198     `
/* THIS CODE IS MY OWN WORK, IT IS WRITTEN WITHOUT CONSULTING A TUTOR OR CODE WRITTEN BY OTHER STUDENT -YIYANG ZHAO*/
// All option attempted: q A t v d x
// Please use myar [option] [arname] {file_names[]}; do not put dash (-) before options
// Ex: myar q t.ar file1 file2...    NOT myar -q ...

/*include*/
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>
#include <sys/stat.h>
#include <utime.h>
#include <time.h>
#include <ar.h>
#include <fcntl.h>
#include <stdio.h>
#include <dirent.h>

//function decs
//#include <myarheader.h>
void ar_list(int ar_fd, int verbosity);
void ar_ext(int ar_fd, int argc, char **argv);
void ar_app(int ar_fd, int argc, char **argv);
void ar_appall(int ar_fd, int argc, char **argv);
void ar_del(int ar_fd, int argc, char **argv);

//main
void print_usage()
{
		printf("Usage: myar key afile name...\n");
		printf("q	quickly append named files to archive\n");
		printf("x	extract named files\n");
		printf("t	print a concise table of contents of the archive\n");
		printf("v	print a verbose table of contents of the archive\n");
		printf("d	delete named files from archive\n");
		printf("A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself\n");
}

int main (int argc, char **argv)
{
	//myar key afile name
	/*
 	q app [named]
	x ext [named]
	t prt(cons)
	v prt(vbo)
	d del [named]
	A app all(mod'd)
	*/
	char option;
	char* ar_filename;
	char* op_filename;
	int ar_fd;

	//argument check
	if (argc <= 2){
		print_usage();
		exit(1);
	}
	//passing arguments: option and ar file name	
	option = argv[1][0];
	ar_filename = argv[2];

	if (!(option == 'q' | option == 'x'|option=='t'|option =='v'|option =='d'|option == 'A')){
		print_usage();
		exit(1);
	}
	//Open the ar file
	
	//test if arfile exist. yes->open no&&'q'|'A'->create otherwise quit
	if ( access( ar_filename, F_OK ) != -1 ){
		//open for use
		ar_fd = open(ar_filename, O_RDWR);
		char magic[8];
		magic[8] = NULL;
		read(ar_fd, magic, 8);
		if(strcmp(magic, ARMAG) != 0){
			printf("Error: File not recorgnized\n");
			close(ar_fd);
			exit(-1);
		}
	} else{

		if (option =='q'||option == 'A'){
			ar_fd = open(ar_filename, O_RDWR|O_CREAT, 0666);
           		printf("Archive file not found; creating new archive file\n");
			write(ar_fd, ARMAG, 8);
			//create file
		} else{
			printf("Error: target archive file not exist\n");	
			exit(-1);	
		}

	}

	/* 
	t,v -> ar_list(ar_fd, int 0(t)/1(v))
	x -> ar_ext(ar_fd,argc,**argv)
	q -> ar_app(ar_fd,argc,**argv)
	A -> ar_appall(ar_fd,(cwd?)) -> ar_app
	d -> ar_del(ar_fd,argc,**argv)
	*/
	switch(option){
	
		case('t'):
			ar_list(ar_fd,0);
			break;
		case('v'):
			ar_list(ar_fd,1);
			break;
		case('q'):
			ar_app(ar_fd,argc,argv);
			break;
		case('x'):
			ar_ext(ar_fd,argc,argv);
			break;
		case('A'):
			ar_appall(ar_fd,argc,argv);
			break;

		case('d'):
			ar_del(ar_fd,argc,argv);
			break;
		default:
			exit(-1);
	}

}


void ar_list(int ar_fd, int verbosity){
	//DONE
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	
	while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)) {
		//printf("readaaa\n");		
		int i;
		int filesize = (int)strtol(file_header->ar_size,NULL,10);		
		for (i=15;i>0;i--){
			//printf("%d\n",i);
			if (file_header->ar_name[i] == '/'){
				file_header->ar_name[i] = NULL;
				break;
			}
		}	
	
		if (!(verbosity)){
			printf("%s\n",file_header->ar_name);
		}else{

			//DONE
			// 3*3mode uid/gid   size timestamp[Oct 13 19:35 2016] filename
			int j;
			//mode			
			for (j=3;j<6;j++){
				int per = file_header->ar_mode[j] - '0';
				int perx = per % 2;
				per = per/2;
				int perw = per % 2;
				per = per/2;
				int perr = per % 2;
				if (perr) printf("r"); else printf("-");
				if (perw) printf("w"); else printf("-");
				if (perx) printf("x"); else printf("-");
			}
			//printf(" ");

			//uid/gid
			int uid = atoi(file_header->ar_uid);
			int gid = atoi(file_header->ar_gid);
			printf("%6d/%-6d ",uid, gid);
			printf("%d", filesize);
			time_t mtimestamp;	 
			mtimestamp = strtol(file_header->ar_date,NULL,10);
			char* printtime[20];
			strftime(printtime, 20, " %b %e %R %Y", localtime(&mtimestamp));
			printf("%-20s", printtime);
			printf("%-16s\n",file_header->ar_name);
		}	
		char *something_weird;	
		
		//printf("%d\n", filesize);
		if (filesize%2) filesize++;
		lseek(ar_fd,filesize,SEEK_CUR);


		
	}

	close(ar_fd);
}


void ar_ext(int ar_fd, int argc, char **argv){
	//TODO

	int i;
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	printf("%d\n",argc);
	for (i=3;i<argc;i++){
		printf("finding %s\n",argv[i]);
		//find named file
		int filesize;
		int flag = 0;
		while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
			int j;			
			for (j = 16; j >=0; j--){
            			if (file_header->ar_name[j] == '/') {
               				file_header->ar_name[j] = '\0';
                 			
					break;
           		 	}
      		 	}
			filesize = (int)strtol(file_header->ar_size,NULL,10);
			
			if ((strcmp(file_header->ar_name, argv[i]) != 0)){
				//skip
				if (filesize%2) filesize++;
				lseek(ar_fd,filesize,SEEK_CUR);
				printf("going thru:%s\n",file_header->ar_name);
		
			} else{
				//break
				flag = 1;
				printf("found %s\n",file_header->ar_name);
				break;
			}
		}
	
		if (flag == 0) {
			printf("Error: file to extract not found.\n");
			exit(-1);
		}
		//create a file	
		struct utimbuf *file_utime = malloc(sizeof(struct utimbuf));
   	 	int *file_mode;
   		time_t file_time;
		
		sscanf(file_header->ar_mode, "%o", file_mode);
		file_time = (time_t)strtol(file_header->ar_date,NULL,10);
		file_utime->actime = file_time;
		file_utime->modtime = file_time;
		//extract its content write using buffer
		printf("%s\n %o\n",file_header->ar_mode,*file_mode);
		int extf_fd = creat(file_header->ar_name,  *file_mode);

			
		struct stat *f_stat = malloc(sizeof(struct stat));
		fstat(extf_fd, f_stat);
		

		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int remaining_size = filesize;
		int actual_size;

		while(remaining_size > f_blocks){
			actual_size = read(ar_fd,f_buffer,f_blocks);
			write(extf_fd,f_buffer,actual_size);
			remaining_size -= actual_size;
		}
		actual_size = read(ar_fd,f_buffer,remaining_size);
		write(extf_fd,f_buffer,actual_size);

		
		close(extf_fd);
		//change time ?
		utime(file_header->ar_name,file_utime);
		
		//lseek to the head?
		lseek(ar_fd,0,8);
	}
	close(ar_fd);
}

void ar_app(int ar_fd, int argc, char **argv){
	//DONE
	//passing in all argument as the main method because we want the list of file names
	//printf("%s\n",argv[3]);
	int file_num = argc - 3;
	int i;
	char* f_name;
	lseek(ar_fd,0,SEEK_END);	
	for (i=3;i<argc;i++){
		
		f_name = argv[i];
		//printf("%s\n",f_name);
		int target_fd;
		struct ar_hdr *f_hdr = malloc(sizeof(struct ar_hdr));
		struct stat *f_stat = malloc(sizeof(struct stat));
		target_fd = open(f_name, O_RDONLY); //the file to be appended
		
		if (target_fd == -1){
			printf("Error: Target file to append not found\n");
			close(target_fd);
			close(ar_fd);
			exit(-1);
		}
		//get metadata of the file 
		fstat(target_fd, f_stat);
		int f_blksz = (int)f_stat->st_blksize;

		char namestr[strlen(f_name)+1];
		strcpy (namestr,f_name);		
		strcat(namestr, "/");
		
		/*
		name 16
		date 12
		uid 6
		gid 6
		mode 8
		size 10
		famg 2
		
		*/
		sprintf(f_hdr->ar_name, "%-16s", namestr);
		sprintf(f_hdr->ar_date,"%-12d",(int)f_stat->st_mtime);
		sprintf(f_hdr->ar_uid,"%-6d", (int)f_stat->st_uid);
		sprintf(f_hdr->ar_gid,"%-6d", (int)f_stat->st_gid);
		
		sprintf(f_hdr->ar_mode,"%-8o",f_stat->st_mode);
		sprintf(f_hdr->ar_size,"%-10d",(int)f_stat->st_size);
		sprintf(f_hdr->ar_fmag,"%-2s",ARFMAG);	
		//printf("%s\n",f_hdr);
		write(ar_fd,f_hdr,sizeof(struct ar_hdr));
		
		//copy the content of the file
		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int actual_size;
		while(actual_size = read(target_fd,f_buffer,f_blocks)){
			
			write(ar_fd,f_buffer,actual_size);

		}
		
		if ((lseek(ar_fd,0,SEEK_END)%2)){
			write(ar_fd,"\n",1);
		}
		
		close(target_fd);

	}
	close(ar_fd);
	exit(0);

}

void ar_appall(int ar_fd, int argc, char **argv){
	//TODO- DONE but need to check
	//artificially generate a list as argv and argc then pass into ar_app :)
	//check current dir, add all file mod in 1h except argv[0] to new_argv
	int count = 0;
	
	DIR *dp;
	dp = opendir("./");
	struct dirent *ep;
	char* new_argv[10000];
	new_argv[0] = argv[0];
	new_argv[1] = "q";
	new_argv[2] = argv[2];
	int new_argc = 2;
	
	while (ep = readdir(dp)){
		if ((ep->d_type == DT_REG) && (strcmp(ep->d_name, argv[2]) != 0)){
			char* filename = ep->d_name;
			struct stat *f_stat = malloc(sizeof(struct stat));
			stat(filename,f_stat);
			//printf("%s\n",filename);
			//printf("%f\n",difftime(time(NULL), f_stat->st_mtime));
			if  ( difftime(time(NULL), f_stat->st_mtime)<=3600){
				new_argc ++;
				new_argv[new_argc] = filename;
				

			}
		}
		

	}

	ar_app(ar_fd,new_argc,new_argv);

	

}

void ar_del(int ar_fd, int argc, char **argv){
	//TODO
	//read through the ar file
	//maintain a list of file 2b deleted
	//if (inlist){skip;inlist.rm()file;} else {read and write}	

	char* to_del[argc - 3];
	int num_to_del = argc - 3;
	int i;
	struct stat *f_stat = malloc(sizeof(struct stat));
	for (i=0; i<argc-3;i++){
		to_del[i] = argv[i+3];
	}
	//creat a new file
	unlink(argv[2]);
	int new_ar_fd= open(argv[2],O_RDWR|O_CREAT,0666);
	write(new_ar_fd, ARMAG, 8);
	fstat(new_ar_fd, f_stat);
	int f_blocks = (int)f_stat->st_blocks;

	//each time read a header and go thru the del_list
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));

	while(read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
		//if inlist?
		
		char *filename = malloc(20);
		sprintf(filename, "%-16s", file_header->ar_name);		
		int j;
		
		for (j=16;j>=0;j--){
			if (filename[j] == '/'){
				filename[j] = '\0';
				break;
			}

		}
		//printf("Searching %s\n",filename);
		int flag = 0;
		for (j=0;j<argc-3;j++){
			//printf("against %s\n",to_del[j]);			
			if ((strcmp(filename, to_del[j]) == 0)){
				
				flag = 1;			
				to_del[j] = "\n";
				break;

			}
		}
		
		int filesize = (int)strtol(file_header->ar_size,NULL,10);
		if (flag == 0){
			//write



			write(new_ar_fd,file_header,sizeof(struct ar_hdr));
			
			//copy the content of the file

			char* f_buffer[f_blocks];
			int remaining_size = filesize;
			int actual_size;

			while(remaining_size > f_blocks){
				actual_size = read(ar_fd,f_buffer,f_blocks);
				write(new_ar_fd,f_buffer,actual_size);
				remaining_size -= actual_size;
			}
			actual_size = read(ar_fd,f_buffer,remaining_size);
			write(new_ar_fd,f_buffer,actual_size);
		
			if ((lseek(new_ar_fd,0,SEEK_CUR)%2)){
				write(new_ar_fd,"\n",1);
			}

			if ((lseek(ar_fd,0,SEEK_CUR)%2)){
				lseek(ar_fd,1,SEEK_CUR);
			}

		} else {
			//skip
			
			if (filesize%2) filesize++;
			lseek(ar_fd,filesize,SEEK_CUR);
			printf("going thru:%s\n",file_header->ar_name);
			
		}

	}

	close(ar_fd);
	close(new_ar_fd);
	exit(0);
}

myar.c/         1477069906  21760 88    100644  11198     `
/* THIS CODE IS MY OWN WORK, IT IS WRITTEN WITHOUT CONSULTING A TUTOR OR CODE WRITTEN BY OTHER STUDENT -YIYANG ZHAO*/
// All option attempted: q A t v d x
// Please use myar [option] [arname] {file_names[]}; do not put dash (-) before options
// Ex: myar q t.ar file1 file2...    NOT myar -q ...

/*include*/
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>
#include <sys/stat.h>
#include <utime.h>
#include <time.h>
#include <ar.h>
#include <fcntl.h>
#include <stdio.h>
#include <dirent.h>

//function decs
//#include <myarheader.h>
void ar_list(int ar_fd, int verbosity);
void ar_ext(int ar_fd, int argc, char **argv);
void ar_app(int ar_fd, int argc, char **argv);
void ar_appall(int ar_fd, int argc, char **argv);
void ar_del(int ar_fd, int argc, char **argv);

//main
void print_usage()
{
		printf("Usage: myar key afile name...\n");
		printf("q	quickly append named files to archive\n");
		printf("x	extract named files\n");
		printf("t	print a concise table of contents of the archive\n");
		printf("v	print a verbose table of contents of the archive\n");
		printf("d	delete named files from archive\n");
		printf("A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself\n");
}

int main (int argc, char **argv)
{
	//myar key afile name
	/*
 	q app [named]
	x ext [named]
	t prt(cons)
	v prt(vbo)
	d del [named]
	A app all(mod'd)
	*/
	char option;
	char* ar_filename;
	char* op_filename;
	int ar_fd;

	//argument check
	if (argc <= 2){
		print_usage();
		exit(1);
	}
	//passing arguments: option and ar file name	
	option = argv[1][0];
	ar_filename = argv[2];

	if (!(option == 'q' | option == 'x'|option=='t'|option =='v'|option =='d'|option == 'A')){
		print_usage();
		exit(1);
	}
	//Open the ar file
	
	//test if arfile exist. yes->open no&&'q'|'A'->create otherwise quit
	if ( access( ar_filename, F_OK ) != -1 ){
		//open for use
		ar_fd = open(ar_filename, O_RDWR);
		char magic[8];
		magic[8] = NULL;
		read(ar_fd, magic, 8);
		if(strcmp(magic, ARMAG) != 0){
			printf("Error: File not recorgnized\n");
			close(ar_fd);
			exit(-1);
		}
	} else{

		if (option =='q'||option == 'A'){
			ar_fd = open(ar_filename, O_RDWR|O_CREAT, 0666);
           		printf("Archive file not found; creating new archive file\n");
			write(ar_fd, ARMAG, 8);
			//create file
		} else{
			printf("Error: target archive file not exist\n");	
			exit(-1);	
		}

	}

	/* 
	t,v -> ar_list(ar_fd, int 0(t)/1(v))
	x -> ar_ext(ar_fd,argc,**argv)
	q -> ar_app(ar_fd,argc,**argv)
	A -> ar_appall(ar_fd,(cwd?)) -> ar_app
	d -> ar_del(ar_fd,argc,**argv)
	*/
	switch(option){
	
		case('t'):
			ar_list(ar_fd,0);
			break;
		case('v'):
			ar_list(ar_fd,1);
			break;
		case('q'):
			ar_app(ar_fd,argc,argv);
			break;
		case('x'):
			ar_ext(ar_fd,argc,argv);
			break;
		case('A'):
			ar_appall(ar_fd,argc,argv);
			break;

		case('d'):
			ar_del(ar_fd,argc,argv);
			break;
		default:
			exit(-1);
	}

}


void ar_list(int ar_fd, int verbosity){
	//DONE
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	
	while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)) {
		//printf("readaaa\n");		
		int i;
		int filesize = (int)strtol(file_header->ar_size,NULL,10);		
		for (i=15;i>0;i--){
			//printf("%d\n",i);
			if (file_header->ar_name[i] == '/'){
				file_header->ar_name[i] = NULL;
				break;
			}
		}	
	
		if (!(verbosity)){
			printf("%s\n",file_header->ar_name);
		}else{

			//DONE
			// 3*3mode uid/gid   size timestamp[Oct 13 19:35 2016] filename
			int j;
			//mode			
			for (j=3;j<6;j++){
				int per = file_header->ar_mode[j] - '0';
				int perx = per % 2;
				per = per/2;
				int perw = per % 2;
				per = per/2;
				int perr = per % 2;
				if (perr) printf("r"); else printf("-");
				if (perw) printf("w"); else printf("-");
				if (perx) printf("x"); else printf("-");
			}
			//printf(" ");

			//uid/gid
			int uid = atoi(file_header->ar_uid);
			int gid = atoi(file_header->ar_gid);
			printf("%6d/%-6d ",uid, gid);
			printf("%d", filesize);
			time_t mtimestamp;	 
			mtimestamp = strtol(file_header->ar_date,NULL,10);
			char* printtime[20];
			strftime(printtime, 20, " %b %e %R %Y", localtime(&mtimestamp));
			printf("%-20s", printtime);
			printf("%-16s\n",file_header->ar_name);
		}	
		char *something_weird;	
		
		//printf("%d\n", filesize);
		if (filesize%2) filesize++;
		lseek(ar_fd,filesize,SEEK_CUR);


		
	}

	close(ar_fd);
}


void ar_ext(int ar_fd, int argc, char **argv){
	//TODO

	int i;
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	printf("%d\n",argc);
	for (i=3;i<argc;i++){
		printf("finding %s\n",argv[i]);
		//find named file
		int filesize;
		int flag = 0;
		while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
			int j;			
			for (j = 16; j >=0; j--){
            			if (file_header->ar_name[j] == '/') {
               				file_header->ar_name[j] = '\0';
                 			
					break;
           		 	}
      		 	}
			filesize = (int)strtol(file_header->ar_size,NULL,10);
			
			if ((strcmp(file_header->ar_name, argv[i]) != 0)){
				//skip
				if (filesize%2) filesize++;
				lseek(ar_fd,filesize,SEEK_CUR);
				printf("going thru:%s\n",file_header->ar_name);
		
			} else{
				//break
				flag = 1;
				printf("found %s\n",file_header->ar_name);
				break;
			}
		}
	
		if (flag == 0) {
			printf("Error: file to extract not found.\n");
			exit(-1);
		}
		//create a file	
		struct utimbuf *file_utime = malloc(sizeof(struct utimbuf));
   	 	int *file_mode;
   		time_t file_time;
		
		sscanf(file_header->ar_mode, "%o", file_mode);
		file_time = (time_t)strtol(file_header->ar_date,NULL,10);
		file_utime->actime = file_time;
		file_utime->modtime = file_time;
		//extract its content write using buffer
		printf("%s\n %o\n",file_header->ar_mode,*file_mode);
		int extf_fd = creat(file_header->ar_name,  *file_mode);

			
		struct stat *f_stat = malloc(sizeof(struct stat));
		fstat(extf_fd, f_stat);
		

		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int remaining_size = filesize;
		int actual_size;

		while(remaining_size > f_blocks){
			actual_size = read(ar_fd,f_buffer,f_blocks);
			write(extf_fd,f_buffer,actual_size);
			remaining_size -= actual_size;
		}
		actual_size = read(ar_fd,f_buffer,remaining_size);
		write(extf_fd,f_buffer,actual_size);

		
		close(extf_fd);
		//change time ?
		utime(file_header->ar_name,file_utime);
		
		//lseek to the head?
		lseek(ar_fd,0,8);
	}
	close(ar_fd);
}

void ar_app(int ar_fd, int argc, char **argv){
	//DONE
	//passing in all argument as the main method because we want the list of file names
	//printf("%s\n",argv[3]);
	int file_num = argc - 3;
	int i;
	char* f_name;
	lseek(ar_fd,0,SEEK_END);	
	for (i=3;i<argc;i++){
		
		f_name = argv[i];
		//printf("%s\n",f_name);
		int target_fd;
		struct ar_hdr *f_hdr = malloc(sizeof(struct ar_hdr));
		struct stat *f_stat = malloc(sizeof(struct stat));
		target_fd = open(f_name, O_RDONLY); //the file to be appended
		
		if (target_fd == -1){
			printf("Error: Target file to append not found\n");
			close(target_fd);
			close(ar_fd);
			exit(-1);
		}
		//get metadata of the file 
		fstat(target_fd, f_stat);
		int f_blksz = (int)f_stat->st_blksize;

		char namestr[strlen(f_name)+1];
		strcpy (namestr,f_name);		
		strcat(namestr, "/");
		
		/*
		name 16
		date 12
		uid 6
		gid 6
		mode 8
		size 10
		famg 2
		
		*/
		sprintf(f_hdr->ar_name, "%-16s", namestr);
		sprintf(f_hdr->ar_date,"%-12d",(int)f_stat->st_mtime);
		sprintf(f_hdr->ar_uid,"%-6d", (int)f_stat->st_uid);
		sprintf(f_hdr->ar_gid,"%-6d", (int)f_stat->st_gid);
		
		sprintf(f_hdr->ar_mode,"%-8o",f_stat->st_mode);
		sprintf(f_hdr->ar_size,"%-10d",(int)f_stat->st_size);
		sprintf(f_hdr->ar_fmag,"%-2s",ARFMAG);	
		//printf("%s\n",f_hdr);
		write(ar_fd,f_hdr,sizeof(struct ar_hdr));
		
		//copy the content of the file
		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int actual_size;
		while(actual_size = read(target_fd,f_buffer,f_blocks)){
			
			write(ar_fd,f_buffer,actual_size);

		}
		
		if ((lseek(ar_fd,0,SEEK_END)%2)){
			write(ar_fd,"\n",1);
		}
		
		close(target_fd);

	}
	close(ar_fd);
	exit(0);

}

void ar_appall(int ar_fd, int argc, char **argv){
	//TODO- DONE but need to check
	//artificially generate a list as argv and argc then pass into ar_app :)
	//check current dir, add all file mod in 1h except argv[0] to new_argv
	int count = 0;
	
	DIR *dp;
	dp = opendir("./");
	struct dirent *ep;
	char* new_argv[10000];
	new_argv[0] = argv[0];
	new_argv[1] = "q";
	new_argv[2] = argv[2];
	int new_argc = 2;
	
	while (ep = readdir(dp) ){
		if ((ep->d_type == DT_REG) && (strcmp(ep->d_name, argv[2]) != 0)){
			char* filename = ep->d_name;
			struct stat *f_stat = malloc(sizeof(struct stat));
			stat(filename,f_stat);
			//printf("%s\n",filename);
			//printf("%f\n",difftime(time(NULL), f_stat->st_mtime));
			if  ( difftime(time(NULL), f_stat->st_mtime)<=3600){
				new_argc ++;
				new_argv[new_argc] = filename;
				

			}
		}
		

	}
	ar_app(ar_fd,new_argc,new_argv);

	

}

void ar_del(int ar_fd, int argc, char **argv){
	//TODO
	//read through the ar file
	//maintain a list of file 2b deleted
	//if (inlist){skip;inlist.rm()file;} else {read and write}	

	char* to_del[argc - 3];
	int num_to_del = argc - 3;
	int i;
	struct stat *f_stat = malloc(sizeof(struct stat));
	for (i=0; i<argc-3;i++){
		to_del[i] = argv[i+3];
	}
	//creat a new file
	unlink(argv[2]);
	int new_ar_fd= open(argv[2],O_RDWR|O_CREAT,0666);
	write(new_ar_fd, ARMAG, 8);
	fstat(new_ar_fd, f_stat);
	int f_blocks = (int)f_stat->st_blocks;

	//each time read a header and go thru the del_list
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));

	while(read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
		//if inlist?
		
		char *filename = malloc(20);
		sprintf(filename, "%-16s", file_header->ar_name);		
		int j;
		
		for (j=16;j>=0;j--){
			if (filename[j] == '/'){
				filename[j] = '\0';
				break;
			}

		}
		//printf("Searching %s\n",filename);
		int flag = 0;
		for (j=0;j<argc-3;j++){
			//printf("against %s\n",to_del[j]);			
			if ((strcmp(filename, to_del[j]) == 0)){
				
				flag = 1;			
				to_del[j] = "\n";
				break;

			}
		}
		
		int filesize = (int)strtol(file_header->ar_size,NULL,10);
		if (flag == 0){
			//write



			write(new_ar_fd,file_header,sizeof(struct ar_hdr));
			
			//copy the content of the file

			char* f_buffer[f_blocks];
			int remaining_size = filesize;
			int actual_size;

			while(remaining_size > f_blocks){
				actual_size = read(ar_fd,f_buffer,f_blocks);
				write(new_ar_fd,f_buffer,actual_size);
				remaining_size -= actual_size;
			}
			actual_size = read(ar_fd,f_buffer,remaining_size);
			write(new_ar_fd,f_buffer,actual_size);
		
			if ((lseek(new_ar_fd,0,SEEK_CUR)%2)){
				write(new_ar_fd,"\n",1);
			}

			if ((lseek(ar_fd,0,SEEK_CUR)%2)){
				lseek(ar_fd,1,SEEK_CUR);
			}

		} else {
			//skip
			
			if (filesize%2) filesize++;
			lseek(ar_fd,filesize,SEEK_CUR);
			printf("going thru:%s\n",file_header->ar_name);
			
		}

	}

	close(ar_fd);
	close(new_ar_fd);
	exit(0);
}

hhhhh/          1477069573  21760 88    100644  32468     `
!<arch>
ggggg/          1477069528  21760 88    100644  16204     `
!<arch>
myar/           1477069457  21760 88    100755  16135     `
ELF          >    0@     @       X)          @ 8  @         @       @ @     @ @                                      @      @                                          @       @     T%      T%                    X%      X%`     X%`                               %      %`     %`                                    @     @     D       D              Ptd   p#      p#@     p#@     d       d              Qtd                                                  /lib64/ld-linux-x86-64.so.2          GNU                       GNU NGp:zbjJu                                                     /                                                                                         F                      6                      !                      R                      q                      |                                            K                                            j                                                                  &                      .                                            v                      c                                                                                                                                                                                                      Z                                                                   __gmon_start__ libc.so.6 strcpy exit readdir sprintf __isoc99_sscanf puts unlink putchar strftime strtol strlen read lseek malloc strcat opendir creat atoi close open localtime difftime utime access strcmp __libc_start_main write __xstat __fxstat GLIBC_2.7 GLIBC_2.2.5                                                ii         ui	         '`                   0'`                   8'`                   @'`                   H'`                   P'`                   X'`                   `'`                   h'`        	           p'`        
           x'`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                    (`                   (`                   (`                   (`                    (`                    H;    E  H5  %  @ %  h    %  h   %  h   %  h   %  h   %  h   %  h   %  h   p%  h   `%  h	   P%  h
   @%  h   0%  h    %  h   %z  h    %r  h   %j  h   %b  h   %Z  h   %R  h   %J  h   %B  h   %:  h   %2  h   p%*  h   `%"  h   P%  h   @%  h   0%
  h    %  h   %  h    1I^HHPTI@ H@ H`@ wHH  HtHUHSH=   uKp%` H  Hh%` HHH9s$fD  HHu  h%` Hg  H9rS  H[fff.     H=   UHt    Htx%` UH@ N@ D@ :(@ 0`@ &@ @ UHH@}Hu}       HEHH  EHEHH HE}q}x	}t	}v	}d	}A	u       HE    HtfHE   H    EE HME   HcHED @ HBt|M @ E}qt}Au>HE  B   H    iEp @ E   D @ ( @ EA7   H @ E    t   pE   c   _HUMEN  JHUME  5HUMER	   HUME
  
UHH   <   "HEI  HEH0
       HEE   $EHUH</uEHUH 
m}  uHEHd  E      EHUHD(0EE)EEEE)EEEE)E} tr   
-   } tw   
-   } tx   
-   E}(HEHH{EHEH"HhE"@ UMH    "@ UH    HEH
       H
HEHEHjH"@ H    Hn"@ H HH    HU"@ HH    yEtEEHc   HpHM<   HH<0UHSHx}uHU<   HE"@ UH    E     HHEHHHEH"@ HH    E       E   $EHUH</uEHUH 
m} yHEH0
       HEEHHHEHHEHHtAEtEEHcE   H*HU"@ HH    "E   HU"@ HH     HME<   H'H<
} u"@    	HE#@ HEH(HUHH    HEH
       HzHEHEHUHHEHUHPHEHEHH(#@ HH    HE HEHE   iHEHUEH	  HEH@@EEHcHHUHHHHHHH)HHHHHEEE7EHcHMEHEEHcHMEHE)EE;EEHcHMEHEEHcHMEHEHEHUHHE       HEE;EEH]UHSHx}uHUEEE       E     HHEHHHEH HE<   HE   HEHE    H    E}u(#@ XE.E$ZHUEH  HEH@8EHEHHHHHUHHHHH)HHHHHEHUHEHH
7#@ HEHHHU9#@ HEHH    iHEH@X?#@ HMHHH    BHE@E#@ HMHHH    HE@ E#@ HMH"HH    HEPJ#@ HMH(HH    HEH@0O#@ HMH0HH    U#@ HUHJ:Z#@ HH    HME<   H#HEH@@EEHcHHUHHHHHHH)HHHHHEEHcHMEHEHcHMEHnE} uE       tE   ]#@ vEHEE;E"E    UHSH8 <8H0E    _#@ 5HEH0H H@HHb#@ H0HH HPE      HE@<   H0HH HUHHHStrHEHHE   YHEHEHUHH  HEHXX    HH%	  f.tEEHHUH@HEHaHEH} >H@M<H8 [UHSHx}uHUEHcHHUHHHHHHH)HHHHHEEE   \HEE    &UEHHHHEHHEHcHEE;EHEHH H+HEHH   B   H    9EE   D @ HUEHa  HEH@@E<   HEN     HEHU9#@ HEHH    E   "EHHE </uEHHE  
m} yE    E    @UHEHcHHEHHuE   UHEHcH]#@ EE;EHEH0
       HE} 1  HHHME<   HEHcHHUHHHHHHH)HHHHHEEE7EHcHMEH@EEHcHMEHfE)EE;EEHcHMEHEEHcHMEH'E       tE   ]#@ E       TtE      9H?EtEEHcE   HHU"@ HH    HME<   H/H<EE    fffff.     Hl$Ld$H-  L%|  Ll$Lt$L|$H\$H8L)AIHIHt1@ LLDAHH9rH\$Hl$Ld$Ll$ Lt$(L|$0H8HH   H   !UHSHH  HtX%` D  HHHuH[HH                Usage: myar key afile name...   q	quickly append named files to archive x	extract named files   t	print a concise table of contents of the archive      v	print a verbose table of contents of the archive      d	delete named files from archive       A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself !<arch>
 Error: File not recorgnized        Archive file not found; creating new archive file       Error: target archive file not exist    F@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     [@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     @     q@     q@     @     q@     @     q@     1@     %6d/%-6d  %d  %b %e %R %Y %-20s %-16s
 %d
 finding %s
 going thru:%s
 found %s
 Error: file to extract not found. %o %s
 %o
    Error: Target file to append not found / %-16s %-12d %-6d %-8o %-10d %-2s `
 
 ./ q           @;d                    ;(  P  @p  P                 zR x        L    ACG     <   H   AC    \   E   AC $   |   [   ACTB            .   ACg    $      V   ACg*            9   ACZ                   $   $      Q_@X      L  (              d                                                                   
@            @     o    `@            @            @     
                                                 '`                                       0@            @                   	              o    @     o           o    @                                                                                                             %`                     F
@     V
@     f
@     v
@     
@     
@     
@     
@     
@     
@     
@     
@     @     @     &@     6@     F@     V@     f@     v@     @     @     @     @     @     @     @     @     @     @     &@         GCC: (GNU) 4.4.7 20120313 (Red Hat 4.4.7-16)  .symtab .strtab .shstrtab .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .text .fini .rodata .eh_frame_hdr .eh_frame .ctors .dtors .jcr .dynamic .got .got.plt .data .bss .comment                                                                                @                                          #             @                                          1             <@     <      $                              D   o       `@     `                                   N             @                                     V             @                                        ^   o       @           B                            k   o       @           0                            z             @                                                    0@     0                                             
@     
                                                 0
@     0
                                                0@     0      x                                          @                                                      @                                                     p#@     p#      d                                           #@     #      |                                          X%`     X%                                                 h%`     h%                                                 x%`     x%                                                 %`     %                                              '`     '                                                '`     '                                               ((`     ((                                                 0(`     ,(                                          0               ,(      -                                                   Y(                                                          0      	         .                 	                      :                                                                  @                   @                   <@                   `@                   @                   @                   @                   @                  	 @                  
 0@                   
@                   0
@                   0@                   @                   @                   p#@                   #@                   X%`                   h%`                   x%`                   %`                   '`                   '`                   ((`                   0(`                                        \@                                      X%`             *     h%`             8     x%`             E     @             [     0(`            j     8(`            x     @                                      `%`                  P%@                  x%`                  p@                                      '`                   T%`                   T%`                 %`                  ((`                                  *    @            :    0@             A                     T                     g                      v                                                                                         @                `@                                                                                                1                     E    }@           M   P@            T  " P@            Y    @            h                     {                         ((`                                                                                                     @               }@     .                              @                 @     L       +                     >                     R   p%`             _    @            o                                             ,(`                                      "@     [                              @(`                                    " `@                                     @     V         ,(`                                  /                     B                     X                     j                     |    `@               
@              call_gmon_start crtstuff.c __CTOR_LIST__ __DTOR_LIST__ __JCR_LIST__ __do_global_dtors_aux completed.6349 dtor_idx.6351 frame_dummy __CTOR_END__ __FRAME_END__ __JCR_END__ __do_global_ctors_aux myar.c _GLOBAL_OFFSET_TABLE_ __init_array_end __init_array_start _DYNAMIC data_start printf@@GLIBC_2.2.5 __libc_csu_fini _start close@@GLIBC_2.2.5 utime@@GLIBC_2.2.5 __gmon_start__ _Jv_RegisterClasses puts@@GLIBC_2.2.5 __isoc99_sscanf@@GLIBC_2.7 exit@@GLIBC_2.2.5 _fini __fstat putchar@@GLIBC_2.2.5 read@@GLIBC_2.2.5 malloc@@GLIBC_2.2.5 __libc_start_main@@GLIBC_2.2.5 unlink@@GLIBC_2.2.5 ar_list __stat stat _IO_stdin_used creat@@GLIBC_2.2.5 strlen@@GLIBC_2.2.5 __data_start opendir@@GLIBC_2.2.5 __xstat@@GLIBC_2.2.5 readdir@@GLIBC_2.2.5 sprintf@@GLIBC_2.2.5 ar_del ar_app strcat@@GLIBC_2.2.5 __dso_handle print_usage lseek@@GLIBC_2.2.5 strtol@@GLIBC_2.2.5 __DTOR_END__ __libc_csu_init atoi@@GLIBC_2.2.5 __fxstat@@GLIBC_2.2.5 __bss_start strcmp@@GLIBC_2.2.5 ar_ext strcpy@@GLIBC_2.2.5 _end difftime@@GLIBC_2.2.5 fstat access@@GLIBC_2.2.5 ar_appall _edata localtime@@GLIBC_2.2.5 write@@GLIBC_2.2.5 strftime@@GLIBC_2.2.5 open@@GLIBC_2.2.5 time@@GLIBC_2.2.5 main _init 
myar/           1477069457  21760 88    100755  16135     `
ELF          >    0@     @       X)          @ 8  @         @       @ @     @ @                                      @      @                                          @       @     T%      T%                    X%      X%`     X%`                               %      %`     %`                                    @     @     D       D              Ptd   p#      p#@     p#@     d       d              Qtd                                                  /lib64/ld-linux-x86-64.so.2          GNU                       GNU NGp:zbjJu                                                     /                                                                                         F                      6                      !                      R                      q                      |                                            K                                            j                                                                  &                      .                                            v                      c                                                                                                                                                                                                      Z                                                                   __gmon_start__ libc.so.6 strcpy exit readdir sprintf __isoc99_sscanf puts unlink putchar strftime strtol strlen read lseek malloc strcat opendir creat atoi close open localtime difftime utime access strcmp __libc_start_main write __xstat __fxstat GLIBC_2.7 GLIBC_2.2.5                                                ii         ui	         '`                   0'`                   8'`                   @'`                   H'`                   P'`                   X'`                   `'`                   h'`        	           p'`        
           x'`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                    (`                   (`                   (`                   (`                    (`                    H;    E  H5  %  @ %  h    %  h   %  h   %  h   %  h   %  h   %  h   %  h   p%  h   `%  h	   P%  h
   @%  h   0%  h    %  h   %z  h    %r  h   %j  h   %b  h   %Z  h   %R  h   %J  h   %B  h   %:  h   %2  h   p%*  h   `%"  h   P%  h   @%  h   0%
  h    %  h   %  h    1I^HHPTI@ H@ H`@ wHH  HtHUHSH=   uKp%` H  Hh%` HHH9s$fD  HHu  h%` Hg  H9rS  H[fff.     H=   UHt    Htx%` UH@ N@ D@ :(@ 0`@ &@ @ UHH@}Hu}       HEHH  EHEHH HE}q}x	}t	}v	}d	}A	u       HE    HtfHE   H    EE HME   HcHED @ HBt|M @ E}qt}Au>HE  B   H    iEp @ E   D @ ( @ EA7   H @ E    t   pE   c   _HUMEN  JHUME  5HUMER	   HUME
  
UHH   <   "HEI  HEH0
       HEE   $EHUH</uEHUH 
m}  uHEHd  E      EHUHD(0EE)EEEE)EEEE)E} tr   
-   } tw   
-   } tx   
-   E}(HEHH{EHEH"HhE"@ UMH    "@ UH    HEH
       H
HEHEHjH"@ H    Hn"@ H HH    HU"@ HH    yEtEEHc   HpHM<   HH<0UHSHx}uHU<   HE"@ UH    E     HHEHHHEH"@ HH    E       E   $EHUH</uEHUH 
m} yHEH0
       HEEHHHEHHEHHtAEtEEHcE   H*HU"@ HH    "E   HU"@ HH     HME<   H'H<
} u"@    	HE#@ HEH(HUHH    HEH
       HzHEHEHUHHEHUHPHEHEHH(#@ HH    HE HEHE   iHEHUEH	  HEH@@EEHcHHUHHHHHHH)HHHHHEEE7EHcHMEHEEHcHMEHE)EE;EEHcHMEHEEHcHMEHEHEHUHHE       HEE;EEH]UHSHx}uHUEEE       E     HHEHHHEH HE<   HE   HEHE    H    E}u(#@ XE.E$ZHUEH  HEH@8EHEHHHHHUHHHHH)HHHHHEHUHEHH
7#@ HEHHHU9#@ HEHH    iHEH@X?#@ HMHHH    BHE@E#@ HMHHH    HE@ E#@ HMH"HH    HEPJ#@ HMH(HH    HEH@0O#@ HMH0HH    U#@ HUHJ:Z#@ HH    HME<   H#HEH@@EEHcHHUHHHHHHH)HHHHHEEHcHMEHEHcHMEHnE} uE       tE   ]#@ vEHEE;E"E    UHSH8 <8H0E    _#@ 5HEH0H H@HHb#@ H0HH HPE      HE@<   H0HH HUHHHStrHEHHE   YHEHEHUHH  HEHXX    HH%	  f.tEEHHUH@HEHaHEH} >H@M<H8 [UHSHx}uHUEHcHHUHHHHHHH)HHHHHEEE   \HEE    &UEHHHHEHHEHcHEE;EHEHH H+HEHH   B   H    9EE   D @ HUEHa  HEH@@E<   HEN     HEHU9#@ HEHH    E   "EHHE </uEHHE  
m} yE    E    @UHEHcHHEHHuE   UHEHcH]#@ EE;EHEH0
       HE} 1  HHHME<   HEHcHHUHHHHHHH)HHHHHEEE7EHcHMEH@EEHcHMEHfE)EE;EEHcHMEHEEHcHMEH'E       tE   ]#@ E       TtE      9H?EtEEHcE   HHU"@ HH    HME<   H/H<EE    fffff.     Hl$Ld$H-  L%|  Ll$Lt$L|$H\$H8L)AIHIHt1@ LLDAHH9rH\$Hl$Ld$Ll$ Lt$(L|$0H8HH   H   !UHSHH  HtX%` D  HHHuH[HH                Usage: myar key afile name...   q	quickly append named files to archive x	extract named files   t	print a concise table of contents of the archive      v	print a verbose table of contents of the archive      d	delete named files from archive       A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself !<arch>
 Error: File not recorgnized        Archive file not found; creating new archive file       Error: target archive file not exist    F@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     [@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     @     q@     q@     @     q@     @     q@     1@     %6d/%-6d  %d  %b %e %R %Y %-20s %-16s
 %d
 finding %s
 going thru:%s
 found %s
 Error: file to extract not found. %o %s
 %o
    Error: Target file to append not found / %-16s %-12d %-6d %-8o %-10d %-2s `
 
 ./ q           @;d                    ;(  P  @p  P                 zR x        L    ACG     <   H   AC    \   E   AC $   |   [   ACTB            .   ACg    $      V   ACg*            9   ACZ                   $   $      Q_@X      L  (              d                                                                   
@            @     o    `@            @            @     
                                                 '`                                       0@            @                   	              o    @     o           o    @                                                                                                             %`                     F
@     V
@     f
@     v
@     
@     
@     
@     
@     
@     
@     
@     
@     @     @     &@     6@     F@     V@     f@     v@     @     @     @     @     @     @     @     @     @     @     &@         GCC: (GNU) 4.4.7 20120313 (Red Hat 4.4.7-16)  .symtab .strtab .shstrtab .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .text .fini .rodata .eh_frame_hdr .eh_frame .ctors .dtors .jcr .dynamic .got .got.plt .data .bss .comment                                                                                @                                          #             @                                          1             <@     <      $                              D   o       `@     `                                   N             @                                     V             @                                        ^   o       @           B                            k   o       @           0                            z             @                                                    0@     0                                             
@     
                                                 0
@     0
                                                0@     0      x                                          @                                                      @                                                     p#@     p#      d                                           #@     #      |                                          X%`     X%                                                 h%`     h%                                                 x%`     x%                                                 %`     %                                              '`     '                                                '`     '                                               ((`     ((                                                 0(`     ,(                                          0               ,(      -                                                   Y(                                                          0      	         .                 	                      :                                                                  @                   @                   <@                   `@                   @                   @                   @                   @                  	 @                  
 0@                   
@                   0
@                   0@                   @                   @                   p#@                   #@                   X%`                   h%`                   x%`                   %`                   '`                   '`                   ((`                   0(`                                        \@                                      X%`             *     h%`             8     x%`             E     @             [     0(`            j     8(`            x     @                                      `%`                  P%@                  x%`                  p@                                      '`                   T%`                   T%`                 %`                  ((`                                  *    @            :    0@             A                     T                     g                      v                                                                                         @                `@                                                                                                1                     E    }@           M   P@            T  " P@            Y    @            h                     {                         ((`                                                                                                     @               }@     .                              @                 @     L       +                     >                     R   p%`             _    @            o                                             ,(`                                      "@     [                              @(`                                    " `@                                     @     V         ,(`                                  /                     B                     X                     j                     |    `@               
@              call_gmon_start crtstuff.c __CTOR_LIST__ __DTOR_LIST__ __JCR_LIST__ __do_global_dtors_aux completed.6349 dtor_idx.6351 frame_dummy __CTOR_END__ __FRAME_END__ __JCR_END__ __do_global_ctors_aux myar.c _GLOBAL_OFFSET_TABLE_ __init_array_end __init_array_start _DYNAMIC data_start printf@@GLIBC_2.2.5 __libc_csu_fini _start close@@GLIBC_2.2.5 utime@@GLIBC_2.2.5 __gmon_start__ _Jv_RegisterClasses puts@@GLIBC_2.2.5 __isoc99_sscanf@@GLIBC_2.7 exit@@GLIBC_2.2.5 _fini __fstat putchar@@GLIBC_2.2.5 read@@GLIBC_2.2.5 malloc@@GLIBC_2.2.5 __libc_start_main@@GLIBC_2.2.5 unlink@@GLIBC_2.2.5 ar_list __stat stat _IO_stdin_used creat@@GLIBC_2.2.5 strlen@@GLIBC_2.2.5 __data_start opendir@@GLIBC_2.2.5 __xstat@@GLIBC_2.2.5 readdir@@GLIBC_2.2.5 sprintf@@GLIBC_2.2.5 ar_del ar_app strcat@@GLIBC_2.2.5 __dso_handle print_usage lseek@@GLIBC_2.2.5 strtol@@GLIBC_2.2.5 __DTOR_END__ __libc_csu_init atoi@@GLIBC_2.2.5 __fxstat@@GLIBC_2.2.5 __bss_start strcmp@@GLIBC_2.2.5 ar_ext strcpy@@GLIBC_2.2.5 _end difftime@@GLIBC_2.2.5 fstat access@@GLIBC_2.2.5 ar_appall _edata localtime@@GLIBC_2.2.5 write@@GLIBC_2.2.5 strftime@@GLIBC_2.2.5 open@@GLIBC_2.2.5 time@@GLIBC_2.2.5 main _init 
ggggg/          1477069528  21760 88    100644  16204     `
!<arch>
myar/           1477069457  21760 88    100755  16135     `
ELF          >    0@     @       X)          @ 8  @         @       @ @     @ @                                      @      @                                          @       @     T%      T%                    X%      X%`     X%`                               %      %`     %`                                    @     @     D       D              Ptd   p#      p#@     p#@     d       d              Qtd                                                  /lib64/ld-linux-x86-64.so.2          GNU                       GNU NGp:zbjJu                                                     /                                                                                         F                      6                      !                      R                      q                      |                                            K                                            j                                                                  &                      .                                            v                      c                                                                                                                                                                                                      Z                                                                   __gmon_start__ libc.so.6 strcpy exit readdir sprintf __isoc99_sscanf puts unlink putchar strftime strtol strlen read lseek malloc strcat opendir creat atoi close open localtime difftime utime access strcmp __libc_start_main write __xstat __fxstat GLIBC_2.7 GLIBC_2.2.5                                                ii         ui	         '`                   0'`                   8'`                   @'`                   H'`                   P'`                   X'`                   `'`                   h'`        	           p'`        
           x'`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                    (`                   (`                   (`                   (`                    (`                    H;    E  H5  %  @ %  h    %  h   %  h   %  h   %  h   %  h   %  h   %  h   p%  h   `%  h	   P%  h
   @%  h   0%  h    %  h   %z  h    %r  h   %j  h   %b  h   %Z  h   %R  h   %J  h   %B  h   %:  h   %2  h   p%*  h   `%"  h   P%  h   @%  h   0%
  h    %  h   %  h    1I^HHPTI@ H@ H`@ wHH  HtHUHSH=   uKp%` H  Hh%` HHH9s$fD  HHu  h%` Hg  H9rS  H[fff.     H=   UHt    Htx%` UH@ N@ D@ :(@ 0`@ &@ @ UHH@}Hu}       HEHH  EHEHH HE}q}x	}t	}v	}d	}A	u       HE    HtfHE   H    EE HME   HcHED @ HBt|M @ E}qt}Au>HE  B   H    iEp @ E   D @ ( @ EA7   H @ E    t   pE   c   _HUMEN  JHUME  5HUMER	   HUME
  
UHH   <   "HEI  HEH0
       HEE   $EHUH</uEHUH 
m}  uHEHd  E      EHUHD(0EE)EEEE)EEEE)E} tr   
-   } tw   
-   } tx   
-   E}(HEHH{EHEH"HhE"@ UMH    "@ UH    HEH
       H
HEHEHjH"@ H    Hn"@ H HH    HU"@ HH    yEtEEHc   HpHM<   HH<0UHSHx}uHU<   HE"@ UH    E     HHEHHHEH"@ HH    E       E   $EHUH</uEHUH 
m} yHEH0
       HEEHHHEHHEHHtAEtEEHcE   H*HU"@ HH    "E   HU"@ HH     HME<   H'H<
} u"@    	HE#@ HEH(HUHH    HEH
       HzHEHEHUHHEHUHPHEHEHH(#@ HH    HE HEHE   iHEHUEH	  HEH@@EEHcHHUHHHHHHH)HHHHHEEE7EHcHMEHEEHcHMEHE)EE;EEHcHMEHEEHcHMEHEHEHUHHE       HEE;EEH]UHSHx}uHUEEE       E     HHEHHHEH HE<   HE   HEHE    H    E}u(#@ XE.E$ZHUEH  HEH@8EHEHHHHHUHHHHH)HHHHHEHUHEHH
7#@ HEHHHU9#@ HEHH    iHEH@X?#@ HMHHH    BHE@E#@ HMHHH    HE@ E#@ HMH"HH    HEPJ#@ HMH(HH    HEH@0O#@ HMH0HH    U#@ HUHJ:Z#@ HH    HME<   H#HEH@@EEHcHHUHHHHHHH)HHHHHEEHcHMEHEHcHMEHnE} uE       tE   ]#@ vEHEE;E"E    UHSH8 <8H0E    _#@ 5HEH0H H@HHb#@ H0HH HPE      HE@<   H0HH HUHHHStrHEHHE   YHEHEHUHH  HEHXX    HH%	  f.tEEHHUH@HEHaHEH} >H@M<H8 [UHSHx}uHUEHcHHUHHHHHHH)HHHHHEEE   \HEE    &UEHHHHEHHEHcHEE;EHEHH H+HEHH   B   H    9EE   D @ HUEHa  HEH@@E<   HEN     HEHU9#@ HEHH    E   "EHHE </uEHHE  
m} yE    E    @UHEHcHHEHHuE   UHEHcH]#@ EE;EHEH0
       HE} 1  HHHME<   HEHcHHUHHHHHHH)HHHHHEEE7EHcHMEH@EEHcHMEHfE)EE;EEHcHMEHEEHcHMEH'E       tE   ]#@ E       TtE      9H?EtEEHcE   HHU"@ HH    HME<   H/H<EE    fffff.     Hl$Ld$H-  L%|  Ll$Lt$L|$H\$H8L)AIHIHt1@ LLDAHH9rH\$Hl$Ld$Ll$ Lt$(L|$0H8HH   H   !UHSHH  HtX%` D  HHHuH[HH                Usage: myar key afile name...   q	quickly append named files to archive x	extract named files   t	print a concise table of contents of the archive      v	print a verbose table of contents of the archive      d	delete named files from archive       A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself !<arch>
 Error: File not recorgnized        Archive file not found; creating new archive file       Error: target archive file not exist    F@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     [@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     @     q@     q@     @     q@     @     q@     1@     %6d/%-6d  %d  %b %e %R %Y %-20s %-16s
 %d
 finding %s
 going thru:%s
 found %s
 Error: file to extract not found. %o %s
 %o
    Error: Target file to append not found / %-16s %-12d %-6d %-8o %-10d %-2s `
 
 ./ q           @;d                    ;(  P  @p  P                 zR x        L    ACG     <   H   AC    \   E   AC $   |   [   ACTB            .   ACg    $      V   ACg*            9   ACZ                   $   $      Q_@X      L  (              d                                                                   
@            @     o    `@            @            @     
                                                 '`                                       0@            @                   	              o    @     o           o    @                                                                                                             %`                     F
@     V
@     f
@     v
@     
@     
@     
@     
@     
@     
@     
@     
@     @     @     &@     6@     F@     V@     f@     v@     @     @     @     @     @     @     @     @     @     @     &@         GCC: (GNU) 4.4.7 20120313 (Red Hat 4.4.7-16)  .symtab .strtab .shstrtab .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .text .fini .rodata .eh_frame_hdr .eh_frame .ctors .dtors .jcr .dynamic .got .got.plt .data .bss .comment                                                                                @                                          #             @                                          1             <@     <      $                              D   o       `@     `                                   N             @                                     V             @                                        ^   o       @           B                            k   o       @           0                            z             @                                                    0@     0                                             
@     
                                                 0
@     0
                                                0@     0      x                                          @                                                      @                                                     p#@     p#      d                                           #@     #      |                                          X%`     X%                                                 h%`     h%                                                 x%`     x%                                                 %`     %                                              '`     '                                                '`     '                                               ((`     ((                                                 0(`     ,(                                          0               ,(      -                                                   Y(                                                          0      	         .                 	                      :                                                                  @                   @                   <@                   `@                   @                   @                   @                   @                  	 @                  
 0@                   
@                   0
@                   0@                   @                   @                   p#@                   #@                   X%`                   h%`                   x%`                   %`                   '`                   '`                   ((`                   0(`                                        \@                                      X%`             *     h%`             8     x%`             E     @             [     0(`            j     8(`            x     @                                      `%`                  P%@                  x%`                  p@                                      '`                   T%`                   T%`                 %`                  ((`                                  *    @            :    0@             A                     T                     g                      v                                                                                         @                `@                                                                                                1                     E    }@           M   P@            T  " P@            Y    @            h                     {                         ((`                                                                                                     @               }@     .                              @                 @     L       +                     >                     R   p%`             _    @            o                                             ,(`                                      "@     [                              @(`                                    " `@                                     @     V         ,(`                                  /                     B                     X                     j                     |    `@               
@              call_gmon_start crtstuff.c __CTOR_LIST__ __DTOR_LIST__ __JCR_LIST__ __do_global_dtors_aux completed.6349 dtor_idx.6351 frame_dummy __CTOR_END__ __FRAME_END__ __JCR_END__ __do_global_ctors_aux myar.c _GLOBAL_OFFSET_TABLE_ __init_array_end __init_array_start _DYNAMIC data_start printf@@GLIBC_2.2.5 __libc_csu_fini _start close@@GLIBC_2.2.5 utime@@GLIBC_2.2.5 __gmon_start__ _Jv_RegisterClasses puts@@GLIBC_2.2.5 __isoc99_sscanf@@GLIBC_2.7 exit@@GLIBC_2.2.5 _fini __fstat putchar@@GLIBC_2.2.5 read@@GLIBC_2.2.5 malloc@@GLIBC_2.2.5 __libc_start_main@@GLIBC_2.2.5 unlink@@GLIBC_2.2.5 ar_list __stat stat _IO_stdin_used creat@@GLIBC_2.2.5 strlen@@GLIBC_2.2.5 __data_start opendir@@GLIBC_2.2.5 __xstat@@GLIBC_2.2.5 readdir@@GLIBC_2.2.5 sprintf@@GLIBC_2.2.5 ar_del ar_app strcat@@GLIBC_2.2.5 __dso_handle print_usage lseek@@GLIBC_2.2.5 strtol@@GLIBC_2.2.5 __DTOR_END__ __libc_csu_init atoi@@GLIBC_2.2.5 __fxstat@@GLIBC_2.2.5 __bss_start strcmp@@GLIBC_2.2.5 ar_ext strcpy@@GLIBC_2.2.5 _end difftime@@GLIBC_2.2.5 fstat access@@GLIBC_2.2.5 ar_appall _edata localtime@@GLIBC_2.2.5 write@@GLIBC_2.2.5 strftime@@GLIBC_2.2.5 open@@GLIBC_2.2.5 time@@GLIBC_2.2.5 main _init 
myar/           1477069913  21760 88    100755  16135     `
ELF          >    0@     @       X)          @ 8  @         @       @ @     @ @                                      @      @                                          @       @     T%      T%                    X%      X%`     X%`                               %      %`     %`                                    @     @     D       D              Ptd   p#      p#@     p#@     d       d              Qtd                                                  /lib64/ld-linux-x86-64.so.2          GNU                       GNU NGp:zbjJu                                                     /                                                                                         F                      6                      !                      R                      q                      |                                            K                                            j                                                                  &                      .                                            v                      c                                                                                                                                                                                                      Z                                                                   __gmon_start__ libc.so.6 strcpy exit readdir sprintf __isoc99_sscanf puts unlink putchar strftime strtol strlen read lseek malloc strcat opendir creat atoi close open localtime difftime utime access strcmp __libc_start_main write __xstat __fxstat GLIBC_2.7 GLIBC_2.2.5                                                ii         ui	         '`                   0'`                   8'`                   @'`                   H'`                   P'`                   X'`                   `'`                   h'`        	           p'`        
           x'`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                    (`                   (`                   (`                   (`                    (`                    H;    E  H5  %  @ %  h    %  h   %  h   %  h   %  h   %  h   %  h   %  h   p%  h   `%  h	   P%  h
   @%  h   0%  h    %  h   %z  h    %r  h   %j  h   %b  h   %Z  h   %R  h   %J  h   %B  h   %:  h   %2  h   p%*  h   `%"  h   P%  h   @%  h   0%
  h    %  h   %  h    1I^HHPTI@ H@ H`@ wHH  HtHUHSH=   uKp%` H  Hh%` HHH9s$fD  HHu  h%` Hg  H9rS  H[fff.     H=   UHt    Htx%` UH@ N@ D@ :(@ 0`@ &@ @ UHH@}Hu}       HEHH  EHEHH HE}q}x	}t	}v	}d	}A	u       HE    HtfHE   H    EE HME   HcHED @ HBt|M @ E}qt}Au>HE  B   H    iEp @ E   D @ ( @ EA7   H @ E    t   pE   c   _HUMEN  JHUME  5HUMER	   HUME
  
UHH   <   "HEI  HEH0
       HEE   $EHUH</uEHUH 
m}  uHEHd  E      EHUHD(0EE)EEEE)EEEE)E} tr   
-   } tw   
-   } tx   
-   E}(HEHH{EHEH"HhE"@ UMH    "@ UH    HEH
       H
HEHEHjH"@ H    Hn"@ H HH    HU"@ HH    yEtEEHc   HpHM<   HH<0UHSHx}uHU<   HE"@ UH    E     HHEHHHEH"@ HH    E       E   $EHUH</uEHUH 
m} yHEH0
       HEEHHHEHHEHHtAEtEEHcE   H*HU"@ HH    "E   HU"@ HH     HME<   H'H<
} u"@    	HE#@ HEH(HUHH    HEH
       HzHEHEHUHHEHUHPHEHEHH(#@ HH    HE HEHE   iHEHUEH	  HEH@@EEHcHHUHHHHHHH)HHHHHEEE7EHcHMEHEEHcHMEHE)EE;EEHcHMEHEEHcHMEHEHEHUHHE       HEE;EEH]UHSHx}uHUEEE       E     HHEHHHEH HE<   HE   HEHE    H    E}u(#@ XE.E$ZHUEH  HEH@8EHEHHHHHUHHHHH)HHHHHEHUHEHH
7#@ HEHHHU9#@ HEHH    iHEH@X?#@ HMHHH    BHE@E#@ HMHHH    HE@ E#@ HMH"HH    HEPJ#@ HMH(HH    HEH@0O#@ HMH0HH    U#@ HUHJ:Z#@ HH    HME<   H#HEH@@EEHcHHUHHHHHHH)HHHHHEEHcHMEHEHcHMEHnE} uE       tE   ]#@ vEHEE;E"E    UHSH8 <8H0E    _#@ 5HEH0H H@HHb#@ H0HH HPE      HE@<   H0HH HUHHHStrHEHHE   YHEHEHUHH  HEHXX    HH%	  f.tEEHHUH@HEHaHEH} >H@M<H8 [UHSHx}uHUEHcHHUHHHHHHH)HHHHHEEE   \HEE    &UEHHHHEHHEHcHEE;EHEHH H+HEHH   B   H    9EE   D @ HUEHa  HEH@@E<   HEN     HEHU9#@ HEHH    E   "EHHE </uEHHE  
m} yE    E    @UHEHcHHEHHuE   UHEHcH]#@ EE;EHEH0
       HE} 1  HHHME<   HEHcHHUHHHHHHH)HHHHHEEE7EHcHMEH@EEHcHMEHfE)EE;EEHcHMEHEEHcHMEH'E       tE   ]#@ E       TtE      9H?EtEEHcE   HHU"@ HH    HME<   H/H<EE    fffff.     Hl$Ld$H-  L%|  Ll$Lt$L|$H\$H8L)AIHIHt1@ LLDAHH9rH\$Hl$Ld$Ll$ Lt$(L|$0H8HH   H   !UHSHH  HtX%` D  HHHuH[HH                Usage: myar key afile name...   q	quickly append named files to archive x	extract named files   t	print a concise table of contents of the archive      v	print a verbose table of contents of the archive      d	delete named files from archive       A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself !<arch>
 Error: File not recorgnized        Archive file not found; creating new archive file       Error: target archive file not exist    F@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     [@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     @     q@     q@     @     q@     @     q@     1@     %6d/%-6d  %d  %b %e %R %Y %-20s %-16s
 %d
 finding %s
 going thru:%s
 found %s
 Error: file to extract not found. %o %s
 %o
    Error: Target file to append not found / %-16s %-12d %-6d %-8o %-10d %-2s `
 
 ./ q           @;d                    ;(  P  @p  P                 zR x        L    ACG     <   H   AC    \   E   AC $   |   [   ACTB            .   ACg    $      V   ACg*            9   ACZ                   $   $      Q_@X      L  (              d                                                                   
@            @     o    `@            @            @     
                                                 '`                                       0@            @                   	              o    @     o           o    @                                                                                                             %`                     F
@     V
@     f
@     v
@     
@     
@     
@     
@     
@     
@     
@     
@     @     @     &@     6@     F@     V@     f@     v@     @     @     @     @     @     @     @     @     @     @     &@         GCC: (GNU) 4.4.7 20120313 (Red Hat 4.4.7-16)  .symtab .strtab .shstrtab .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .text .fini .rodata .eh_frame_hdr .eh_frame .ctors .dtors .jcr .dynamic .got .got.plt .data .bss .comment                                                                                @                                          #             @                                          1             <@     <      $                              D   o       `@     `                                   N             @                                     V             @                                        ^   o       @           B                            k   o       @           0                            z             @                                                    0@     0                                             
@     
                                                 0
@     0
                                                0@     0      x                                          @                                                      @                                                     p#@     p#      d                                           #@     #      |                                          X%`     X%                                                 h%`     h%                                                 x%`     x%                                                 %`     %                                              '`     '                                                '`     '                                               ((`     ((                                                 0(`     ,(                                          0               ,(      -                                                   Y(                                                          0      	         .                 	                      :                                                                  @                   @                   <@                   `@                   @                   @                   @                   @                  	 @                  
 0@                   
@                   0
@                   0@                   @                   @                   p#@                   #@                   X%`                   h%`                   x%`                   %`                   '`                   '`                   ((`                   0(`                                        \@                                      X%`             *     h%`             8     x%`             E     @             [     0(`            j     8(`            x     @                                      `%`                  P%@                  x%`                  p@                                      '`                   T%`                   T%`                 %`                  ((`                                  *    @            :    0@             A                     T                     g                      v                                                                                         @                `@                                                                                                1                     E    }@           M   P@            T  " P@            Y    @            h                     {                         ((`                                                                                                     @               }@     .                              @                 @     L       +                     >                     R   p%`             _    @            o                                             ,(`                                      "@     [                              @(`                                    " `@                                     @     V         ,(`                                  /                     B                     X                     j                     |    `@               
@              call_gmon_start crtstuff.c __CTOR_LIST__ __DTOR_LIST__ __JCR_LIST__ __do_global_dtors_aux completed.6349 dtor_idx.6351 frame_dummy __CTOR_END__ __FRAME_END__ __JCR_END__ __do_global_ctors_aux myar.c _GLOBAL_OFFSET_TABLE_ __init_array_end __init_array_start _DYNAMIC data_start printf@@GLIBC_2.2.5 __libc_csu_fini _start close@@GLIBC_2.2.5 utime@@GLIBC_2.2.5 __gmon_start__ _Jv_RegisterClasses puts@@GLIBC_2.2.5 __isoc99_sscanf@@GLIBC_2.7 exit@@GLIBC_2.2.5 _fini __fstat putchar@@GLIBC_2.2.5 read@@GLIBC_2.2.5 malloc@@GLIBC_2.2.5 __libc_start_main@@GLIBC_2.2.5 unlink@@GLIBC_2.2.5 ar_list __stat stat _IO_stdin_used creat@@GLIBC_2.2.5 strlen@@GLIBC_2.2.5 __data_start opendir@@GLIBC_2.2.5 __xstat@@GLIBC_2.2.5 readdir@@GLIBC_2.2.5 sprintf@@GLIBC_2.2.5 ar_del ar_app strcat@@GLIBC_2.2.5 __dso_handle print_usage lseek@@GLIBC_2.2.5 strtol@@GLIBC_2.2.5 __DTOR_END__ __libc_csu_init atoi@@GLIBC_2.2.5 __fxstat@@GLIBC_2.2.5 __bss_start strcmp@@GLIBC_2.2.5 ar_ext strcpy@@GLIBC_2.2.5 _end difftime@@GLIBC_2.2.5 fstat access@@GLIBC_2.2.5 ar_appall _edata localtime@@GLIBC_2.2.5 write@@GLIBC_2.2.5 strftime@@GLIBC_2.2.5 open@@GLIBC_2.2.5 time@@GLIBC_2.2.5 main _init 
myar.c/         1477070181  21760 88    100644  11227     `
/* THIS CODE IS MY OWN WORK, IT IS WRITTEN WITHOUT CONSULTING A TUTOR OR CODE WRITTEN BY OTHER STUDENT -YIYANG ZHAO*/
// All option attempted: q A t v d x
// Please use myar [option] [arname] {file_names[]}; do not put dash (-) before options
// Ex: myar q t.ar file1 file2...    NOT myar -q ...

/*include*/
#include <stdlib.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>
#include <sys/stat.h>
#include <utime.h>
#include <time.h>
#include <ar.h>
#include <fcntl.h>
#include <stdio.h>
#include <dirent.h>

//function decs
//#include <myarheader.h>
void ar_list(int ar_fd, int verbosity);
void ar_ext(int ar_fd, int argc, char **argv);
void ar_app(int ar_fd, int argc, char **argv);
void ar_appall(int ar_fd, int argc, char **argv);
void ar_del(int ar_fd, int argc, char **argv);

//main
void print_usage()
{
		printf("Usage: myar key afile name...\n");
		printf("q	quickly append named files to archive\n");
		printf("x	extract named files\n");
		printf("t	print a concise table of contents of the archive\n");
		printf("v	print a verbose table of contents of the archive\n");
		printf("d	delete named files from archive\n");
		printf("A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself\n");
}

int main (int argc, char **argv)
{
	//myar key afile name
	/*
 	q app [named]
	x ext [named]
	t prt(cons)
	v prt(vbo)
	d del [named]
	A app all(mod'd)
	*/
	char option;
	char* ar_filename;
	char* op_filename;
	int ar_fd;

	//argument check
	if (argc <= 2){
		print_usage();
		exit(1);
	}
	//passing arguments: option and ar file name	
	option = argv[1][0];
	ar_filename = argv[2];

	if (!(option == 'q' | option == 'x'|option=='t'|option =='v'|option =='d'|option == 'A')){
		print_usage();
		exit(1);
	}
	//Open the ar file
	
	//test if arfile exist. yes->open no&&'q'|'A'->create otherwise quit
	if ( access( ar_filename, F_OK ) != -1 ){
		//open for use
		ar_fd = open(ar_filename, O_RDWR);
		char magic[8];
		magic[8] = NULL;
		read(ar_fd, magic, 8);
		if(strcmp(magic, ARMAG) != 0){
			printf("Error: File not recorgnized\n");
			close(ar_fd);
			exit(-1);
		}
	} else{

		if (option =='q'||option == 'A'){
			ar_fd = open(ar_filename, O_RDWR|O_CREAT, 0666);
           		printf("Archive file not found; creating new archive file\n");
			write(ar_fd, ARMAG, 8);
			//create file
		} else{
			printf("Error: target archive file not exist\n");	
			exit(-1);	
		}

	}

	/* 
	t,v -> ar_list(ar_fd, int 0(t)/1(v))
	x -> ar_ext(ar_fd,argc,**argv)
	q -> ar_app(ar_fd,argc,**argv)
	A -> ar_appall(ar_fd,(cwd?)) -> ar_app
	d -> ar_del(ar_fd,argc,**argv)
	*/
	switch(option){
	
		case('t'):
			ar_list(ar_fd,0);
			break;
		case('v'):
			ar_list(ar_fd,1);
			break;
		case('q'):
			ar_app(ar_fd,argc,argv);
			break;
		case('x'):
			ar_ext(ar_fd,argc,argv);
			break;
		case('A'):
			ar_appall(ar_fd,argc,argv);
			break;

		case('d'):
			ar_del(ar_fd,argc,argv);
			break;
		default:
			exit(-1);
	}

}


void ar_list(int ar_fd, int verbosity){
	//DONE
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	
	while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)) {
		//printf("readaaa\n");		
		int i;
		int filesize = (int)strtol(file_header->ar_size,NULL,10);		
		for (i=15;i>0;i--){
			//printf("%d\n",i);
			if (file_header->ar_name[i] == '/'){
				file_header->ar_name[i] = NULL;
				break;
			}
		}	
	
		if (!(verbosity)){
			printf("%s\n",file_header->ar_name);
		}else{

			//DONE
			// 3*3mode uid/gid   size timestamp[Oct 13 19:35 2016] filename
			int j;
			//mode			
			for (j=3;j<6;j++){
				int per = file_header->ar_mode[j] - '0';
				int perx = per % 2;
				per = per/2;
				int perw = per % 2;
				per = per/2;
				int perr = per % 2;
				if (perr) printf("r"); else printf("-");
				if (perw) printf("w"); else printf("-");
				if (perx) printf("x"); else printf("-");
			}
			//printf(" ");

			//uid/gid
			int uid = atoi(file_header->ar_uid);
			int gid = atoi(file_header->ar_gid);
			printf("%6d/%-6d ",uid, gid);
			printf("%d", filesize);
			time_t mtimestamp;	 
			mtimestamp = strtol(file_header->ar_date,NULL,10);
			char* printtime[20];
			strftime(printtime, 20, " %b %e %R %Y", localtime(&mtimestamp));
			printf("%-20s", printtime);
			printf("%-16s\n",file_header->ar_name);
		}	
		char *something_weird;	
		
		//printf("%d\n", filesize);
		if (filesize%2) filesize++;
		lseek(ar_fd,filesize,SEEK_CUR);


		
	}

	close(ar_fd);
}


void ar_ext(int ar_fd, int argc, char **argv){
	//TODO

	int i;
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));
	printf("%d\n",argc);
	for (i=3;i<argc;i++){
		printf("finding %s\n",argv[i]);
		//find named file
		int filesize;
		int flag = 0;
		while (read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
			int j;			
			for (j = 16; j >=0; j--){
            			if (file_header->ar_name[j] == '/') {
               				file_header->ar_name[j] = '\0';
                 			
					break;
           		 	}
      		 	}
			filesize = (int)strtol(file_header->ar_size,NULL,10);
			
			if ((strcmp(file_header->ar_name, argv[i]) != 0)){
				//skip
				if (filesize%2) filesize++;
				lseek(ar_fd,filesize,SEEK_CUR);
				printf("going thru:%s\n",file_header->ar_name);
		
			} else{
				//break
				flag = 1;
				printf("found %s\n",file_header->ar_name);
				break;
			}
		}
	
		if (flag == 0) {
			printf("Error: file to extract not found.\n");
			exit(-1);
		}
		//create a file	
		struct utimbuf *file_utime = malloc(sizeof(struct utimbuf));
   	 	int *file_mode;
   		time_t file_time;
		
		sscanf(file_header->ar_mode, "%o", file_mode);
		file_time = (time_t)strtol(file_header->ar_date,NULL,10);
		file_utime->actime = file_time;
		file_utime->modtime = file_time;
		//extract its content write using buffer
		printf("%s\n %o\n",file_header->ar_mode,*file_mode);
		int extf_fd = creat(file_header->ar_name,  *file_mode);

			
		struct stat *f_stat = malloc(sizeof(struct stat));
		fstat(extf_fd, f_stat);
		

		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int remaining_size = filesize;
		int actual_size;

		while(remaining_size > f_blocks){
			actual_size = read(ar_fd,f_buffer,f_blocks);
			write(extf_fd,f_buffer,actual_size);
			remaining_size -= actual_size;
		}
		actual_size = read(ar_fd,f_buffer,remaining_size);
		write(extf_fd,f_buffer,actual_size);

		
		close(extf_fd);
		//change time ?
		utime(file_header->ar_name,file_utime);
		
		//lseek to the head?
		lseek(ar_fd,0,8);
	}
	close(ar_fd);
}

void ar_app(int ar_fd, int argc, char **argv){
	//DONE
	//passing in all argument as the main method because we want the list of file names
	//printf("%s\n",argv[3]);
	int file_num = argc - 3;
	int i;
	char* f_name;
	lseek(ar_fd,0,SEEK_END);	
	for (i=3;i<argc;i++){
		
		f_name = argv[i];
		//printf("%s\n",f_name);
		int target_fd;
		struct ar_hdr *f_hdr = malloc(sizeof(struct ar_hdr));
		struct stat *f_stat = malloc(sizeof(struct stat));
		target_fd = open(f_name, O_RDONLY); //the file to be appended
		
		if (target_fd == -1){
			printf("Error: Target file to append not found\n");
			close(target_fd);
			close(ar_fd);
			exit(-1);
		}
		//get metadata of the file 
		fstat(target_fd, f_stat);
		int f_blksz = (int)f_stat->st_blksize;

		char namestr[strlen(f_name)+1];
		strcpy (namestr,f_name);		
		strcat(namestr, "/");
		
		/*
		name 16
		date 12
		uid 6
		gid 6
		mode 8
		size 10
		famg 2
		
		*/
		sprintf(f_hdr->ar_name, "%-16s", namestr);
		sprintf(f_hdr->ar_date,"%-12d",(int)f_stat->st_mtime);
		sprintf(f_hdr->ar_uid,"%-6d", (int)f_stat->st_uid);
		sprintf(f_hdr->ar_gid,"%-6d", (int)f_stat->st_gid);
		
		sprintf(f_hdr->ar_mode,"%-8o",f_stat->st_mode);
		sprintf(f_hdr->ar_size,"%-10d",(int)f_stat->st_size);
		sprintf(f_hdr->ar_fmag,"%-2s",ARFMAG);	
		//printf("%s\n",f_hdr);
		write(ar_fd,f_hdr,sizeof(struct ar_hdr));
		
		//copy the content of the file
		int f_blocks = (int)f_stat->st_blocks;
		char* f_buffer[f_blocks];
		int actual_size;
		while(actual_size = read(target_fd,f_buffer,f_blocks)){
			
			write(ar_fd,f_buffer,actual_size);

		}
		
		if ((lseek(ar_fd,0,SEEK_END)%2)){
			write(ar_fd,"\n",1);
		}
		
		close(target_fd);

	}
	close(ar_fd);
	exit(0);

}

void ar_appall(int ar_fd, int argc, char **argv){
	//TODO- DONE but need to check
	//artificially generate a list as argv and argc then pass into ar_app :)
	//check current dir, add all file mod in 1h except argv[0] to new_argv
	int count = 0;
	
	DIR *dp;
	dp = opendir("./");
	struct dirent *ep;
	char* new_argv[10000];
	new_argv[0] = argv[0];
	new_argv[1] = "q";
	new_argv[2] = argv[2];
	int new_argc = 2;
	
	while (ep = readdir(dp) ){
		if ((ep->d_type == DT_REG) && (strcmp(ep->d_name, argv[2]) != 0)){
			char* filename = ep->d_name;
			struct stat *f_stat = malloc(sizeof(struct stat));
			stat(filename,f_stat);
			//printf("%s\n",filename);
			//printf("%f\n",difftime(time(NULL), f_stat->st_mtime));
			if  ( difftime(time(NULL), f_stat->st_mtime)<=3600){
				printf("%s\n",filename);
				new_argc ++;
				new_argv[new_argc] = filename;
				

			}
		}
		

	}
	ar_app(ar_fd,new_argc,new_argv);

	

}

void ar_del(int ar_fd, int argc, char **argv){
	//TODO
	//read through the ar file
	//maintain a list of file 2b deleted
	//if (inlist){skip;inlist.rm()file;} else {read and write}	

	char* to_del[argc - 3];
	int num_to_del = argc - 3;
	int i;
	struct stat *f_stat = malloc(sizeof(struct stat));
	for (i=0; i<argc-3;i++){
		to_del[i] = argv[i+3];
	}
	//creat a new file
	unlink(argv[2]);
	int new_ar_fd= open(argv[2],O_RDWR|O_CREAT,0666);
	write(new_ar_fd, ARMAG, 8);
	fstat(new_ar_fd, f_stat);
	int f_blocks = (int)f_stat->st_blocks;

	//each time read a header and go thru the del_list
	struct ar_hdr * file_header = malloc(sizeof(struct ar_hdr));

	while(read(ar_fd, file_header, sizeof(struct ar_hdr)) == sizeof(struct ar_hdr)){
		//if inlist?
		
		char *filename = malloc(20);
		sprintf(filename, "%-16s", file_header->ar_name);		
		int j;
		
		for (j=16;j>=0;j--){
			if (filename[j] == '/'){
				filename[j] = '\0';
				break;
			}

		}
		//printf("Searching %s\n",filename);
		int flag = 0;
		for (j=0;j<argc-3;j++){
			//printf("against %s\n",to_del[j]);			
			if ((strcmp(filename, to_del[j]) == 0)){
				
				flag = 1;			
				to_del[j] = "\n";
				break;

			}
		}
		
		int filesize = (int)strtol(file_header->ar_size,NULL,10);
		if (flag == 0){
			//write



			write(new_ar_fd,file_header,sizeof(struct ar_hdr));
			
			//copy the content of the file

			char* f_buffer[f_blocks];
			int remaining_size = filesize;
			int actual_size;

			while(remaining_size > f_blocks){
				actual_size = read(ar_fd,f_buffer,f_blocks);
				write(new_ar_fd,f_buffer,actual_size);
				remaining_size -= actual_size;
			}
			actual_size = read(ar_fd,f_buffer,remaining_size);
			write(new_ar_fd,f_buffer,actual_size);
		
			if ((lseek(new_ar_fd,0,SEEK_CUR)%2)){
				write(new_ar_fd,"\n",1);
			}

			if ((lseek(ar_fd,0,SEEK_CUR)%2)){
				lseek(ar_fd,1,SEEK_CUR);
			}

		} else {
			//skip
			
			if (filesize%2) filesize++;
			lseek(ar_fd,filesize,SEEK_CUR);
			printf("going thru:%s\n",file_header->ar_name);
			
		}

	}

	close(ar_fd);
	close(new_ar_fd);
	exit(0);
}


hhhhh/          1477069573  21760 88    100644  32468     `
!<arch>
ggggg/          1477069528  21760 88    100644  16204     `
!<arch>
myar/           1477069457  21760 88    100755  16135     `
ELF          >    0@     @       X)          @ 8  @         @       @ @     @ @                                      @      @                                          @       @     T%      T%                    X%      X%`     X%`                               %      %`     %`                                    @     @     D       D              Ptd   p#      p#@     p#@     d       d              Qtd                                                  /lib64/ld-linux-x86-64.so.2          GNU                       GNU NGp:zbjJu                                                     /                                                                                         F                      6                      !                      R                      q                      |                                            K                                            j                                                                  &                      .                                            v                      c                                                                                                                                                                                                      Z                                                                   __gmon_start__ libc.so.6 strcpy exit readdir sprintf __isoc99_sscanf puts unlink putchar strftime strtol strlen read lseek malloc strcat opendir creat atoi close open localtime difftime utime access strcmp __libc_start_main write __xstat __fxstat GLIBC_2.7 GLIBC_2.2.5                                                ii         ui	         '`                   0'`                   8'`                   @'`                   H'`                   P'`                   X'`                   `'`                   h'`        	           p'`        
           x'`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                    (`                   (`                   (`                   (`                    (`                    H;    E  H5  %  @ %  h    %  h   %  h   %  h   %  h   %  h   %  h   %  h   p%  h   `%  h	   P%  h
   @%  h   0%  h    %  h   %z  h    %r  h   %j  h   %b  h   %Z  h   %R  h   %J  h   %B  h   %:  h   %2  h   p%*  h   `%"  h   P%  h   @%  h   0%
  h    %  h   %  h    1I^HHPTI@ H@ H`@ wHH  HtHUHSH=   uKp%` H  Hh%` HHH9s$fD  HHu  h%` Hg  H9rS  H[fff.     H=   UHt    Htx%` UH@ N@ D@ :(@ 0`@ &@ @ UHH@}Hu}       HEHH  EHEHH HE}q}x	}t	}v	}d	}A	u       HE    HtfHE   H    EE HME   HcHED @ HBt|M @ E}qt}Au>HE  B   H    iEp @ E   D @ ( @ EA7   H @ E    t   pE   c   _HUMEN  JHUME  5HUMER	   HUME
  
UHH   <   "HEI  HEH0
       HEE   $EHUH</uEHUH 
m}  uHEHd  E      EHUHD(0EE)EEEE)EEEE)E} tr   
-   } tw   
-   } tx   
-   E}(HEHH{EHEH"HhE"@ UMH    "@ UH    HEH
       H
HEHEHjH"@ H    Hn"@ H HH    HU"@ HH    yEtEEHc   HpHM<   HH<0UHSHx}uHU<   HE"@ UH    E     HHEHHHEH"@ HH    E       E   $EHUH</uEHUH 
m} yHEH0
       HEEHHHEHHEHHtAEtEEHcE   H*HU"@ HH    "E   HU"@ HH     HME<   H'H<
} u"@    	HE#@ HEH(HUHH    HEH
       HzHEHEHUHHEHUHPHEHEHH(#@ HH    HE HEHE   iHEHUEH	  HEH@@EEHcHHUHHHHHHH)HHHHHEEE7EHcHMEHEEHcHMEHE)EE;EEHcHMEHEEHcHMEHEHEHUHHE       HEE;EEH]UHSHx}uHUEEE       E     HHEHHHEH HE<   HE   HEHE    H    E}u(#@ XE.E$ZHUEH  HEH@8EHEHHHHHUHHHHH)HHHHHEHUHEHH
7#@ HEHHHU9#@ HEHH    iHEH@X?#@ HMHHH    BHE@E#@ HMHHH    HE@ E#@ HMH"HH    HEPJ#@ HMH(HH    HEH@0O#@ HMH0HH    U#@ HUHJ:Z#@ HH    HME<   H#HEH@@EEHcHHUHHHHHHH)HHHHHEEHcHMEHEHcHMEHnE} uE       tE   ]#@ vEHEE;E"E    UHSH8 <8H0E    _#@ 5HEH0H H@HHb#@ H0HH HPE      HE@<   H0HH HUHHHStrHEHHE   YHEHEHUHH  HEHXX    HH%	  f.tEEHHUH@HEHaHEH} >H@M<H8 [UHSHx}uHUEHcHHUHHHHHHH)HHHHHEEE   \HEE    &UEHHHHEHHEHcHEE;EHEHH H+HEHH   B   H    9EE   D @ HUEHa  HEH@@E<   HEN     HEHU9#@ HEHH    E   "EHHE </uEHHE  
m} yE    E    @UHEHcHHEHHuE   UHEHcH]#@ EE;EHEH0
       HE} 1  HHHME<   HEHcHHUHHHHHHH)HHHHHEEE7EHcHMEH@EEHcHMEHfE)EE;EEHcHMEHEEHcHMEH'E       tE   ]#@ E       TtE      9H?EtEEHcE   HHU"@ HH    HME<   H/H<EE    fffff.     Hl$Ld$H-  L%|  Ll$Lt$L|$H\$H8L)AIHIHt1@ LLDAHH9rH\$Hl$Ld$Ll$ Lt$(L|$0H8HH   H   !UHSHH  HtX%` D  HHHuH[HH                Usage: myar key afile name...   q	quickly append named files to archive x	extract named files   t	print a concise table of contents of the archive      v	print a verbose table of contents of the archive      d	delete named files from archive       A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself !<arch>
 Error: File not recorgnized        Archive file not found; creating new archive file       Error: target archive file not exist    F@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     [@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     @     q@     q@     @     q@     @     q@     1@     %6d/%-6d  %d  %b %e %R %Y %-20s %-16s
 %d
 finding %s
 going thru:%s
 found %s
 Error: file to extract not found. %o %s
 %o
    Error: Target file to append not found / %-16s %-12d %-6d %-8o %-10d %-2s `
 
 ./ q           @;d                    ;(  P  @p  P                 zR x        L    ACG     <   H   AC    \   E   AC $   |   [   ACTB            .   ACg    $      V   ACg*            9   ACZ                   $   $      Q_@X      L  (              d                                                                   
@            @     o    `@            @            @     
                                                 '`                                       0@            @                   	              o    @     o           o    @                                                                                                             %`                     F
@     V
@     f
@     v
@     
@     
@     
@     
@     
@     
@     
@     
@     @     @     &@     6@     F@     V@     f@     v@     @     @     @     @     @     @     @     @     @     @     &@         GCC: (GNU) 4.4.7 20120313 (Red Hat 4.4.7-16)  .symtab .strtab .shstrtab .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .text .fini .rodata .eh_frame_hdr .eh_frame .ctors .dtors .jcr .dynamic .got .got.plt .data .bss .comment                                                                                @                                          #             @                                          1             <@     <      $                              D   o       `@     `                                   N             @                                     V             @                                        ^   o       @           B                            k   o       @           0                            z             @                                                    0@     0                                             
@     
                                                 0
@     0
                                                0@     0      x                                          @                                                      @                                                     p#@     p#      d                                           #@     #      |                                          X%`     X%                                                 h%`     h%                                                 x%`     x%                                                 %`     %                                              '`     '                                                '`     '                                               ((`     ((                                                 0(`     ,(                                          0               ,(      -                                                   Y(                                                          0      	         .                 	                      :                                                                  @                   @                   <@                   `@                   @                   @                   @                   @                  	 @                  
 0@                   
@                   0
@                   0@                   @                   @                   p#@                   #@                   X%`                   h%`                   x%`                   %`                   '`                   '`                   ((`                   0(`                                        \@                                      X%`             *     h%`             8     x%`             E     @             [     0(`            j     8(`            x     @                                      `%`                  P%@                  x%`                  p@                                      '`                   T%`                   T%`                 %`                  ((`                                  *    @            :    0@             A                     T                     g                      v                                                                                         @                `@                                                                                                1                     E    }@           M   P@            T  " P@            Y    @            h                     {                         ((`                                                                                                     @               }@     .                              @                 @     L       +                     >                     R   p%`             _    @            o                                             ,(`                                      "@     [                              @(`                                    " `@                                     @     V         ,(`                                  /                     B                     X                     j                     |    `@               
@              call_gmon_start crtstuff.c __CTOR_LIST__ __DTOR_LIST__ __JCR_LIST__ __do_global_dtors_aux completed.6349 dtor_idx.6351 frame_dummy __CTOR_END__ __FRAME_END__ __JCR_END__ __do_global_ctors_aux myar.c _GLOBAL_OFFSET_TABLE_ __init_array_end __init_array_start _DYNAMIC data_start printf@@GLIBC_2.2.5 __libc_csu_fini _start close@@GLIBC_2.2.5 utime@@GLIBC_2.2.5 __gmon_start__ _Jv_RegisterClasses puts@@GLIBC_2.2.5 __isoc99_sscanf@@GLIBC_2.7 exit@@GLIBC_2.2.5 _fini __fstat putchar@@GLIBC_2.2.5 read@@GLIBC_2.2.5 malloc@@GLIBC_2.2.5 __libc_start_main@@GLIBC_2.2.5 unlink@@GLIBC_2.2.5 ar_list __stat stat _IO_stdin_used creat@@GLIBC_2.2.5 strlen@@GLIBC_2.2.5 __data_start opendir@@GLIBC_2.2.5 __xstat@@GLIBC_2.2.5 readdir@@GLIBC_2.2.5 sprintf@@GLIBC_2.2.5 ar_del ar_app strcat@@GLIBC_2.2.5 __dso_handle print_usage lseek@@GLIBC_2.2.5 strtol@@GLIBC_2.2.5 __DTOR_END__ __libc_csu_init atoi@@GLIBC_2.2.5 __fxstat@@GLIBC_2.2.5 __bss_start strcmp@@GLIBC_2.2.5 ar_ext strcpy@@GLIBC_2.2.5 _end difftime@@GLIBC_2.2.5 fstat access@@GLIBC_2.2.5 ar_appall _edata localtime@@GLIBC_2.2.5 write@@GLIBC_2.2.5 strftime@@GLIBC_2.2.5 open@@GLIBC_2.2.5 time@@GLIBC_2.2.5 main _init 
myar/           1477069457  21760 88    100755  16135     `
ELF          >    0@     @       X)          @ 8  @         @       @ @     @ @                                      @      @                                          @       @     T%      T%                    X%      X%`     X%`                               %      %`     %`                                    @     @     D       D              Ptd   p#      p#@     p#@     d       d              Qtd                                                  /lib64/ld-linux-x86-64.so.2          GNU                       GNU NGp:zbjJu                                                     /                                                                                         F                      6                      !                      R                      q                      |                                            K                                            j                                                                  &                      .                                            v                      c                                                                                                                                                                                                      Z                                                                   __gmon_start__ libc.so.6 strcpy exit readdir sprintf __isoc99_sscanf puts unlink putchar strftime strtol strlen read lseek malloc strcat opendir creat atoi close open localtime difftime utime access strcmp __libc_start_main write __xstat __fxstat GLIBC_2.7 GLIBC_2.2.5                                                ii         ui	         '`                   0'`                   8'`                   @'`                   H'`                   P'`                   X'`                   `'`                   h'`        	           p'`        
           x'`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                    (`                   (`                   (`                   (`                    (`                    H;    E  H5  %  @ %  h    %  h   %  h   %  h   %  h   %  h   %  h   %  h   p%  h   `%  h	   P%  h
   @%  h   0%  h    %  h   %z  h    %r  h   %j  h   %b  h   %Z  h   %R  h   %J  h   %B  h   %:  h   %2  h   p%*  h   `%"  h   P%  h   @%  h   0%
  h    %  h   %  h    1I^HHPTI@ H@ H`@ wHH  HtHUHSH=   uKp%` H  Hh%` HHH9s$fD  HHu  h%` Hg  H9rS  H[fff.     H=   UHt    Htx%` UH@ N@ D@ :(@ 0`@ &@ @ UHH@}Hu}       HEHH  EHEHH HE}q}x	}t	}v	}d	}A	u       HE    HtfHE   H    EE HME   HcHED @ HBt|M @ E}qt}Au>HE  B   H    iEp @ E   D @ ( @ EA7   H @ E    t   pE   c   _HUMEN  JHUME  5HUMER	   HUME
  
UHH   <   "HEI  HEH0
       HEE   $EHUH</uEHUH 
m}  uHEHd  E      EHUHD(0EE)EEEE)EEEE)E} tr   
-   } tw   
-   } tx   
-   E}(HEHH{EHEH"HhE"@ UMH    "@ UH    HEH
       H
HEHEHjH"@ H    Hn"@ H HH    HU"@ HH    yEtEEHc   HpHM<   HH<0UHSHx}uHU<   HE"@ UH    E     HHEHHHEH"@ HH    E       E   $EHUH</uEHUH 
m} yHEH0
       HEEHHHEHHEHHtAEtEEHcE   H*HU"@ HH    "E   HU"@ HH     HME<   H'H<
} u"@    	HE#@ HEH(HUHH    HEH
       HzHEHEHUHHEHUHPHEHEHH(#@ HH    HE HEHE   iHEHUEH	  HEH@@EEHcHHUHHHHHHH)HHHHHEEE7EHcHMEHEEHcHMEHE)EE;EEHcHMEHEEHcHMEHEHEHUHHE       HEE;EEH]UHSHx}uHUEEE       E     HHEHHHEH HE<   HE   HEHE    H    E}u(#@ XE.E$ZHUEH  HEH@8EHEHHHHHUHHHHH)HHHHHEHUHEHH
7#@ HEHHHU9#@ HEHH    iHEH@X?#@ HMHHH    BHE@E#@ HMHHH    HE@ E#@ HMH"HH    HEPJ#@ HMH(HH    HEH@0O#@ HMH0HH    U#@ HUHJ:Z#@ HH    HME<   H#HEH@@EEHcHHUHHHHHHH)HHHHHEEHcHMEHEHcHMEHnE} uE       tE   ]#@ vEHEE;E"E    UHSH8 <8H0E    _#@ 5HEH0H H@HHb#@ H0HH HPE      HE@<   H0HH HUHHHStrHEHHE   YHEHEHUHH  HEHXX    HH%	  f.tEEHHUH@HEHaHEH} >H@M<H8 [UHSHx}uHUEHcHHUHHHHHHH)HHHHHEEE   \HEE    &UEHHHHEHHEHcHEE;EHEHH H+HEHH   B   H    9EE   D @ HUEHa  HEH@@E<   HEN     HEHU9#@ HEHH    E   "EHHE </uEHHE  
m} yE    E    @UHEHcHHEHHuE   UHEHcH]#@ EE;EHEH0
       HE} 1  HHHME<   HEHcHHUHHHHHHH)HHHHHEEE7EHcHMEH@EEHcHMEHfE)EE;EEHcHMEHEEHcHMEH'E       tE   ]#@ E       TtE      9H?EtEEHcE   HHU"@ HH    HME<   H/H<EE    fffff.     Hl$Ld$H-  L%|  Ll$Lt$L|$H\$H8L)AIHIHt1@ LLDAHH9rH\$Hl$Ld$Ll$ Lt$(L|$0H8HH   H   !UHSHH  HtX%` D  HHHuH[HH                Usage: myar key afile name...   q	quickly append named files to archive x	extract named files   t	print a concise table of contents of the archive      v	print a verbose table of contents of the archive      d	delete named files from archive       A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself !<arch>
 Error: File not recorgnized        Archive file not found; creating new archive file       Error: target archive file not exist    F@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     [@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     @     q@     q@     @     q@     @     q@     1@     %6d/%-6d  %d  %b %e %R %Y %-20s %-16s
 %d
 finding %s
 going thru:%s
 found %s
 Error: file to extract not found. %o %s
 %o
    Error: Target file to append not found / %-16s %-12d %-6d %-8o %-10d %-2s `
 
 ./ q           @;d                    ;(  P  @p  P                 zR x        L    ACG     <   H   AC    \   E   AC $   |   [   ACTB            .   ACg    $      V   ACg*            9   ACZ                   $   $      Q_@X      L  (              d                                                                   
@            @     o    `@            @            @     
                                                 '`                                       0@            @                   	              o    @     o           o    @                                                                                                             %`                     F
@     V
@     f
@     v
@     
@     
@     
@     
@     
@     
@     
@     
@     @     @     &@     6@     F@     V@     f@     v@     @     @     @     @     @     @     @     @     @     @     &@         GCC: (GNU) 4.4.7 20120313 (Red Hat 4.4.7-16)  .symtab .strtab .shstrtab .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .text .fini .rodata .eh_frame_hdr .eh_frame .ctors .dtors .jcr .dynamic .got .got.plt .data .bss .comment                                                                                @                                          #             @                                          1             <@     <      $                              D   o       `@     `                                   N             @                                     V             @                                        ^   o       @           B                            k   o       @           0                            z             @                                                    0@     0                                             
@     
                                                 0
@     0
                                                0@     0      x                                          @                                                      @                                                     p#@     p#      d                                           #@     #      |                                          X%`     X%                                                 h%`     h%                                                 x%`     x%                                                 %`     %                                              '`     '                                                '`     '                                               ((`     ((                                                 0(`     ,(                                          0               ,(      -                                                   Y(                                                          0      	         .                 	                      :                                                                  @                   @                   <@                   `@                   @                   @                   @                   @                  	 @                  
 0@                   
@                   0
@                   0@                   @                   @                   p#@                   #@                   X%`                   h%`                   x%`                   %`                   '`                   '`                   ((`                   0(`                                        \@                                      X%`             *     h%`             8     x%`             E     @             [     0(`            j     8(`            x     @                                      `%`                  P%@                  x%`                  p@                                      '`                   T%`                   T%`                 %`                  ((`                                  *    @            :    0@             A                     T                     g                      v                                                                                         @                `@                                                                                                1                     E    }@           M   P@            T  " P@            Y    @            h                     {                         ((`                                                                                                     @               }@     .                              @                 @     L       +                     >                     R   p%`             _    @            o                                             ,(`                                      "@     [                              @(`                                    " `@                                     @     V         ,(`                                  /                     B                     X                     j                     |    `@               
@              call_gmon_start crtstuff.c __CTOR_LIST__ __DTOR_LIST__ __JCR_LIST__ __do_global_dtors_aux completed.6349 dtor_idx.6351 frame_dummy __CTOR_END__ __FRAME_END__ __JCR_END__ __do_global_ctors_aux myar.c _GLOBAL_OFFSET_TABLE_ __init_array_end __init_array_start _DYNAMIC data_start printf@@GLIBC_2.2.5 __libc_csu_fini _start close@@GLIBC_2.2.5 utime@@GLIBC_2.2.5 __gmon_start__ _Jv_RegisterClasses puts@@GLIBC_2.2.5 __isoc99_sscanf@@GLIBC_2.7 exit@@GLIBC_2.2.5 _fini __fstat putchar@@GLIBC_2.2.5 read@@GLIBC_2.2.5 malloc@@GLIBC_2.2.5 __libc_start_main@@GLIBC_2.2.5 unlink@@GLIBC_2.2.5 ar_list __stat stat _IO_stdin_used creat@@GLIBC_2.2.5 strlen@@GLIBC_2.2.5 __data_start opendir@@GLIBC_2.2.5 __xstat@@GLIBC_2.2.5 readdir@@GLIBC_2.2.5 sprintf@@GLIBC_2.2.5 ar_del ar_app strcat@@GLIBC_2.2.5 __dso_handle print_usage lseek@@GLIBC_2.2.5 strtol@@GLIBC_2.2.5 __DTOR_END__ __libc_csu_init atoi@@GLIBC_2.2.5 __fxstat@@GLIBC_2.2.5 __bss_start strcmp@@GLIBC_2.2.5 ar_ext strcpy@@GLIBC_2.2.5 _end difftime@@GLIBC_2.2.5 fstat access@@GLIBC_2.2.5 ar_appall _edata localtime@@GLIBC_2.2.5 write@@GLIBC_2.2.5 strftime@@GLIBC_2.2.5 open@@GLIBC_2.2.5 time@@GLIBC_2.2.5 main _init 
ggggg/          1477069528  21760 88    100644  16204     `
!<arch>
myar/           1477069457  21760 88    100755  16135     `
ELF          >    0@     @       X)          @ 8  @         @       @ @     @ @                                      @      @                                          @       @     T%      T%                    X%      X%`     X%`                               %      %`     %`                                    @     @     D       D              Ptd   p#      p#@     p#@     d       d              Qtd                                                  /lib64/ld-linux-x86-64.so.2          GNU                       GNU NGp:zbjJu                                                     /                                                                                         F                      6                      !                      R                      q                      |                                            K                                            j                                                                  &                      .                                            v                      c                                                                                                                                                                                                      Z                                                                   __gmon_start__ libc.so.6 strcpy exit readdir sprintf __isoc99_sscanf puts unlink putchar strftime strtol strlen read lseek malloc strcat opendir creat atoi close open localtime difftime utime access strcmp __libc_start_main write __xstat __fxstat GLIBC_2.7 GLIBC_2.2.5                                                ii         ui	         '`                   0'`                   8'`                   @'`                   H'`                   P'`                   X'`                   `'`                   h'`        	           p'`        
           x'`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                    (`                   (`                   (`                   (`                    (`                    H;    E  H5  %  @ %  h    %  h   %  h   %  h   %  h   %  h   %  h   %  h   p%  h   `%  h	   P%  h
   @%  h   0%  h    %  h   %z  h    %r  h   %j  h   %b  h   %Z  h   %R  h   %J  h   %B  h   %:  h   %2  h   p%*  h   `%"  h   P%  h   @%  h   0%
  h    %  h   %  h    1I^HHPTI@ H@ H`@ wHH  HtHUHSH=   uKp%` H  Hh%` HHH9s$fD  HHu  h%` Hg  H9rS  H[fff.     H=   UHt    Htx%` UH@ N@ D@ :(@ 0`@ &@ @ UHH@}Hu}       HEHH  EHEHH HE}q}x	}t	}v	}d	}A	u       HE    HtfHE   H    EE HME   HcHED @ HBt|M @ E}qt}Au>HE  B   H    iEp @ E   D @ ( @ EA7   H @ E    t   pE   c   _HUMEN  JHUME  5HUMER	   HUME
  
UHH   <   "HEI  HEH0
       HEE   $EHUH</uEHUH 
m}  uHEHd  E      EHUHD(0EE)EEEE)EEEE)E} tr   
-   } tw   
-   } tx   
-   E}(HEHH{EHEH"HhE"@ UMH    "@ UH    HEH
       H
HEHEHjH"@ H    Hn"@ H HH    HU"@ HH    yEtEEHc   HpHM<   HH<0UHSHx}uHU<   HE"@ UH    E     HHEHHHEH"@ HH    E       E   $EHUH</uEHUH 
m} yHEH0
       HEEHHHEHHEHHtAEtEEHcE   H*HU"@ HH    "E   HU"@ HH     HME<   H'H<
} u"@    	HE#@ HEH(HUHH    HEH
       HzHEHEHUHHEHUHPHEHEHH(#@ HH    HE HEHE   iHEHUEH	  HEH@@EEHcHHUHHHHHHH)HHHHHEEE7EHcHMEHEEHcHMEHE)EE;EEHcHMEHEEHcHMEHEHEHUHHE       HEE;EEH]UHSHx}uHUEEE       E     HHEHHHEH HE<   HE   HEHE    H    E}u(#@ XE.E$ZHUEH  HEH@8EHEHHHHHUHHHHH)HHHHHEHUHEHH
7#@ HEHHHU9#@ HEHH    iHEH@X?#@ HMHHH    BHE@E#@ HMHHH    HE@ E#@ HMH"HH    HEPJ#@ HMH(HH    HEH@0O#@ HMH0HH    U#@ HUHJ:Z#@ HH    HME<   H#HEH@@EEHcHHUHHHHHHH)HHHHHEEHcHMEHEHcHMEHnE} uE       tE   ]#@ vEHEE;E"E    UHSH8 <8H0E    _#@ 5HEH0H H@HHb#@ H0HH HPE      HE@<   H0HH HUHHHStrHEHHE   YHEHEHUHH  HEHXX    HH%	  f.tEEHHUH@HEHaHEH} >H@M<H8 [UHSHx}uHUEHcHHUHHHHHHH)HHHHHEEE   \HEE    &UEHHHHEHHEHcHEE;EHEHH H+HEHH   B   H    9EE   D @ HUEHa  HEH@@E<   HEN     HEHU9#@ HEHH    E   "EHHE </uEHHE  
m} yE    E    @UHEHcHHEHHuE   UHEHcH]#@ EE;EHEH0
       HE} 1  HHHME<   HEHcHHUHHHHHHH)HHHHHEEE7EHcHMEH@EEHcHMEHfE)EE;EEHcHMEHEEHcHMEH'E       tE   ]#@ E       TtE      9H?EtEEHcE   HHU"@ HH    HME<   H/H<EE    fffff.     Hl$Ld$H-  L%|  Ll$Lt$L|$H\$H8L)AIHIHt1@ LLDAHH9rH\$Hl$Ld$Ll$ Lt$(L|$0H8HH   H   !UHSHH  HtX%` D  HHHuH[HH                Usage: myar key afile name...   q	quickly append named files to archive x	extract named files   t	print a concise table of contents of the archive      v	print a verbose table of contents of the archive      d	delete named files from archive       A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself !<arch>
 Error: File not recorgnized        Archive file not found; creating new archive file       Error: target archive file not exist    F@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     [@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     @     q@     q@     @     q@     @     q@     1@     %6d/%-6d  %d  %b %e %R %Y %-20s %-16s
 %d
 finding %s
 going thru:%s
 found %s
 Error: file to extract not found. %o %s
 %o
    Error: Target file to append not found / %-16s %-12d %-6d %-8o %-10d %-2s `
 
 ./ q           @;d                    ;(  P  @p  P                 zR x        L    ACG     <   H   AC    \   E   AC $   |   [   ACTB            .   ACg    $      V   ACg*            9   ACZ                   $   $      Q_@X      L  (              d                                                                   
@            @     o    `@            @            @     
                                                 '`                                       0@            @                   	              o    @     o           o    @                                                                                                             %`                     F
@     V
@     f
@     v
@     
@     
@     
@     
@     
@     
@     
@     
@     @     @     &@     6@     F@     V@     f@     v@     @     @     @     @     @     @     @     @     @     @     &@         GCC: (GNU) 4.4.7 20120313 (Red Hat 4.4.7-16)  .symtab .strtab .shstrtab .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .text .fini .rodata .eh_frame_hdr .eh_frame .ctors .dtors .jcr .dynamic .got .got.plt .data .bss .comment                                                                                @                                          #             @                                          1             <@     <      $                              D   o       `@     `                                   N             @                                     V             @                                        ^   o       @           B                            k   o       @           0                            z             @                                                    0@     0                                             
@     
                                                 0
@     0
                                                0@     0      x                                          @                                                      @                                                     p#@     p#      d                                           #@     #      |                                          X%`     X%                                                 h%`     h%                                                 x%`     x%                                                 %`     %                                              '`     '                                                '`     '                                               ((`     ((                                                 0(`     ,(                                          0               ,(      -                                                   Y(                                                          0      	         .                 	                      :                                                                  @                   @                   <@                   `@                   @                   @                   @                   @                  	 @                  
 0@                   
@                   0
@                   0@                   @                   @                   p#@                   #@                   X%`                   h%`                   x%`                   %`                   '`                   '`                   ((`                   0(`                                        \@                                      X%`             *     h%`             8     x%`             E     @             [     0(`            j     8(`            x     @                                      `%`                  P%@                  x%`                  p@                                      '`                   T%`                   T%`                 %`                  ((`                                  *    @            :    0@             A                     T                     g                      v                                                                                         @                `@                                                                                                1                     E    }@           M   P@            T  " P@            Y    @            h                     {                         ((`                                                                                                     @               }@     .                              @                 @     L       +                     >                     R   p%`             _    @            o                                             ,(`                                      "@     [                              @(`                                    " `@                                     @     V         ,(`                                  /                     B                     X                     j                     |    `@               
@              call_gmon_start crtstuff.c __CTOR_LIST__ __DTOR_LIST__ __JCR_LIST__ __do_global_dtors_aux completed.6349 dtor_idx.6351 frame_dummy __CTOR_END__ __FRAME_END__ __JCR_END__ __do_global_ctors_aux myar.c _GLOBAL_OFFSET_TABLE_ __init_array_end __init_array_start _DYNAMIC data_start printf@@GLIBC_2.2.5 __libc_csu_fini _start close@@GLIBC_2.2.5 utime@@GLIBC_2.2.5 __gmon_start__ _Jv_RegisterClasses puts@@GLIBC_2.2.5 __isoc99_sscanf@@GLIBC_2.7 exit@@GLIBC_2.2.5 _fini __fstat putchar@@GLIBC_2.2.5 read@@GLIBC_2.2.5 malloc@@GLIBC_2.2.5 __libc_start_main@@GLIBC_2.2.5 unlink@@GLIBC_2.2.5 ar_list __stat stat _IO_stdin_used creat@@GLIBC_2.2.5 strlen@@GLIBC_2.2.5 __data_start opendir@@GLIBC_2.2.5 __xstat@@GLIBC_2.2.5 readdir@@GLIBC_2.2.5 sprintf@@GLIBC_2.2.5 ar_del ar_app strcat@@GLIBC_2.2.5 __dso_handle print_usage lseek@@GLIBC_2.2.5 strtol@@GLIBC_2.2.5 __DTOR_END__ __libc_csu_init atoi@@GLIBC_2.2.5 __fxstat@@GLIBC_2.2.5 __bss_start strcmp@@GLIBC_2.2.5 ar_ext strcpy@@GLIBC_2.2.5 _end difftime@@GLIBC_2.2.5 fstat access@@GLIBC_2.2.5 ar_appall _edata localtime@@GLIBC_2.2.5 write@@GLIBC_2.2.5 strftime@@GLIBC_2.2.5 open@@GLIBC_2.2.5 time@@GLIBC_2.2.5 main _init 
myar/           1477070202  21760 88    100755  16151     `
ELF          >    0@     @       h)          @ 8  @         @       @ @     @ @                                      @      @                                          @       @     d%      d%                    h%      h%`     h%`                               %      %`     %`                                    @     @     D       D              Ptd   #      #@     #@     d       d              Qtd                                                  /lib64/ld-linux-x86-64.so.2          GNU                       GNU :}B_.LhS:F                                                     /                                                                                         F                      6                      !                      R                      q                      |                                            K                                            j                                                                  &                      .                                            v                      c                                                                                                                                                                                                      Z                                                                   __gmon_start__ libc.so.6 strcpy exit readdir sprintf __isoc99_sscanf puts unlink putchar strftime strtol strlen read lseek malloc strcat opendir creat atoi close open localtime difftime utime access strcmp __libc_start_main write __xstat __fxstat GLIBC_2.7 GLIBC_2.2.5                                                ii         ui	          '`                   @'`                   H'`                   P'`                   X'`                   `'`                   h'`                   p'`                   x'`        	           '`        
           '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                   '`                    (`                   (`                   (`                   (`                    (`                   ((`                   0(`                    H;    U  H5  %  @ %  h    %  h   %  h   %  h   %  h   %  h   %  h   %  h   p%  h   `%  h	   P%  h
   @%  h   0%  h    %  h   %  h    %  h   %z  h   %r  h   %j  h   %b  h   %Z  h   %R  h   %J  h   %B  h   p%:  h   `%2  h   P%*  h   @%"  h   0%  h    %  h   %
  h    1I^HHPTI@ H@ H`@ wHH  HtHUHSH=   uK%` H  Hx%` HHH9s$fD  HH  x%` Hw  H9rc  H[fff.     H=   UHt    Ht%` UH@ N@ D @ :8@ 0p@ &@ @ UHH@}Hu}       HEHH  EHEHH HE}q}x	}t	}v	}d	}A	u       HE    HtfHE   H    EE HME   HcHET @ HBt|] @ E}qt}Au>HE  B   H    iE @ E   T @ ( @ EA7   H @ E    t   pE   c   _HUMEN  JHUME  5HUMER	   HUME
  
UHH   <   "HEI  HEH0
       HEE   $EHUH</uEHUH 
m}  uHEHd  E      EHUHD(0EE)EEEE)EEEE)E} tr   
-   } tw   
-   } tx   
-   E}(HEHH{EHEH"HhE"@ UMH    "@ UH    HEH
       H
HEHEHjH"@ H    Hn"@ H HH    HU"@ HH    yEtEEHc   HpHM<   HH<0UHSHx}uHU<   HE"@ UH    E     HHEHHHEH"@ HH    E       E   $EHUH</uEHUH 
m} yHEH0
       HEEHHHEHHEHHtAEtEEHcE   H*HU"@ HH    "E   HU"@ HH     HME<   H'H<
} u"@    	HE#@ HEH(HUHH    HEH
       HzHEHEHUHHEHUHPHEHEHH(#@ HH    HE HEHE   iHEHUEH
  HEH@@EEHcHHUHHHHHHH)HHHHHEEE7EHcHMEHEEHcHMEHE)EE;EEHcHMEHEEHcHMEHEHEHUHHE       HEE;EEH]UHSHx}uHUEEE       E     HHEHHHEH HE<   HE   HEHE    H    E}u( #@ XE.E$ZHUEH)  HEH@8EHEHHHHHUHHHHH)HHHHHEHUHEHH
G#@ HEHHHUI#@ HEHH    iHEH@XO#@ HMHHH    BHE@U#@ HMHHH    HE@ U#@ HMH"HH    HEPZ#@ HMH(HH    HEH@0_#@ HMH0HH    e#@ HUHJ:j#@ HH    HME<   H#HEH@@EEHcHHUHHHHHHH)HHHHHEEHcHMEHEHcHMEHnE} uE       tE   m#@ vEHEE;E"E    UHSH8 <8H0E    o#@ 5HEH0H H@HHr#@ H0HH HPE      HE@<   H0HH HUHHHSt~HEHHE   YHEHEHUHH  HEHXX    HH%	  f.t!HEHEEHHUH@HEHUHEH} 2H@M<zH8 [UHSHx}uHUEHcHHUHHHHHHH)HHHHHEEE   PHEE    &UEHHHHEHHEHcHEE;EHEHH HHEHH   B   H    -EE   T @ HUEHe  HEH@@E<   HEN     HEHUI#@ HEHH    E   "EHHE </uEHHE  
m} yE    E    @UHEHcHHEHHuE   UHEHcHm#@ EE;EHEH0
       HvE} 1  HHHME<   HEHcHHUHHHHHHH)HHHHHEEE7EHcHMEH4EEHcHMEHZE)EE;EEHcHMEHEEHcHMEHE       wtE   m#@ E       HtE      -H?EtEEHcE   HHU"@ HH    HME<   H#H<EE    fffff.     Hl$Ld$H-  L%|  Ll$Lt$L|$H\$H8L)AIHIHt1@ LLDAHH9rH\$Hl$Ld$Ll$ Lt$(L|$0H8HH   H   UHSHH  Hth%` D  HHHuH[HH                Usage: myar key afile name...   q	quickly append named files to archive x	extract named files   t	print a concise table of contents of the archive      v	print a verbose table of contents of the archive      d	delete named files from archive       A	quickly append all ordinary files in the current directory that have been modified within the last hour except the archive itself !<arch>
 Error: File not recorgnized        Archive file not found; creating new archive file       Error: target archive file not exist    F@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     [@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     q@     @     q@     q@     @     q@     @     q@     1@     %6d/%-6d  %d  %b %e %R %Y %-20s %-16s
 %d
 finding %s
 going thru:%s
 found %s
 Error: file to extract not found. %o %s
 %o
    Error: Target file to append not found / %-16s %-12d %-6d %-8o %-10d %-2s `
 
 ./ q           @;d                    +(  P  @p  P                 zR x        L    ACG     <   8   AC    \   5   AC $   |   [   ACTB            .   ACg    $      b   ACg6            5   ACZ                   $   $      Q_@X      L  (              d                                                                   
@            @     o    `@            @            @     
                                                 ('`                                       0@            @                   	              o    @     o           o    @                                                                                                             %`                     F
@     V
@     f
@     v
@     
@     
@     
@     
@     
@     
@     
@     
@     @     @     &@     6@     F@     V@     f@     v@     @     @     @     @     @     @     @     @     @     @     &@         GCC: (GNU) 4.4.7 20120313 (Red Hat 4.4.7-16)  .symtab .strtab .shstrtab .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .text .fini .rodata .eh_frame_hdr .eh_frame .ctors .dtors .jcr .dynamic .got .got.plt .data .bss .comment                                                                                @                                          #             @                                          1             <@     <      $                              D   o       `@     `                                   N             @                                     V             @                                        ^   o       @           B                            k   o       @           0                            z             @                                                    0@     0                                             
@     
                                                 0
@     0
                                                0@     0                                                @                                                      @                                                     #@     #      d                                           #@     #      |                                          h%`     h%                                                 x%`     x%                                                 %`     %                                                 %`     %                                               '`      '                                                ('`     ('                                               8(`     8(                                                 @(`     <(                                          0               <(      -                                                   i(                                                          0      	         .                 	                      :                                                                  @                   @                   <@                   `@                   @                   @                   @                   @                  	 @                  
 0@                   
@                   0
@                   0@                   @                   @                   #@                   #@                   h%`                   x%`                   %`                   %`                    '`                   ('`                   8(`                   @(`                                        \@                                      h%`             *     x%`             8     %`             E     @             [     @(`            j     H(`            x     @                                      p%`                  `%@                  %`                  @                                      ('`                   d%`                   d%`                 %`                  8(`                                  *    @            :    0@             A                     T                     g                      v                                                                                         @                p@                                                                                                1                     E    }@           M   `@            T  " `@            Y    @            h                     {                         8(`                                                                                                     @               }@     .                              @                 @     L       +                     >                     R   %`             _    @            o                                             <(`                                      "@     [                              P(`                                    " p@                                     @     b         <(`                                  /                     B                     X                     j                     |    `@               
@              call_gmon_start crtstuff.c __CTOR_LIST__ __DTOR_LIST__ __JCR_LIST__ __do_global_dtors_aux completed.6349 dtor_idx.6351 frame_dummy __CTOR_END__ __FRAME_END__ __JCR_END__ __do_global_ctors_aux myar.c _GLOBAL_OFFSET_TABLE_ __init_array_end __init_array_start _DYNAMIC data_start printf@@GLIBC_2.2.5 __libc_csu_fini _start close@@GLIBC_2.2.5 utime@@GLIBC_2.2.5 __gmon_start__ _Jv_RegisterClasses puts@@GLIBC_2.2.5 __isoc99_sscanf@@GLIBC_2.7 exit@@GLIBC_2.2.5 _fini __fstat putchar@@GLIBC_2.2.5 read@@GLIBC_2.2.5 malloc@@GLIBC_2.2.5 __libc_start_main@@GLIBC_2.2.5 unlink@@GLIBC_2.2.5 ar_list __stat stat _IO_stdin_used creat@@GLIBC_2.2.5 strlen@@GLIBC_2.2.5 __data_start opendir@@GLIBC_2.2.5 __xstat@@GLIBC_2.2.5 readdir@@GLIBC_2.2.5 sprintf@@GLIBC_2.2.5 ar_del ar_app strcat@@GLIBC_2.2.5 __dso_handle print_usage lseek@@GLIBC_2.2.5 strtol@@GLIBC_2.2.5 __DTOR_END__ __libc_csu_init atoi@@GLIBC_2.2.5 __fxstat@@GLIBC_2.2.5 __bss_start strcmp@@GLIBC_2.2.5 ar_ext strcpy@@GLIBC_2.2.5 _end difftime@@GLIBC_2.2.5 fstat access@@GLIBC_2.2.5 ar_appall _edata localtime@@GLIBC_2.2.5 write@@GLIBC_2.2.5 strftime@@GLIBC_2.2.5 open@@GLIBC_2.2.5 time@@GLIBC_2.2.5 main _init 
